<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2H559N5J64"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-2H559N5J64');
</script>
    <meta charset="UTF-8">
    <title>Idle BTC Miner | GAME</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --btc: #f7931a; --bg: #050505; --panel: #111; --green: #00ff88; --red: #ff3344; --border: #222; }
        body { font-family: 'Inter', -apple-system, sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 20px; overflow: hidden; height: 100vh; box-sizing: border-box; }
        
        #main-layout { display: grid; grid-template-columns: 7fr 3fr; gap: 20px; height: calc(100vh - 40px); }
        .panel { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; display: flex; flex-direction: column; padding: 24px; position: relative; overflow: hidden; }
        
        .nw-label { font-size: 1.2rem; color: #555; text-transform: uppercase; letter-spacing: 3px; font-weight: 700; }
        .nw-amount { 
            font-size: 4.5rem; 
            font-weight: 950; 
            color: var(--green); 
            font-family: monospace; 
            line-height: 1; 
            margin: 8px 0; 
            letter-spacing: -3px; 
            white-space: nowrap;
        }
        .btc-stat { font-size: 2.2rem; color: var(--btc); font-weight: bold; font-family: monospace; border-bottom: 2px solid var(--border); padding-bottom: 12px; margin-bottom: 25px; }

        /* Restoring the 2-column feel for the first two, but allowing the 3rd to be wide */
        .mini-stats { display: flex; justify-content: space-between; gap: 30px; margin-bottom: 15px; }
        .stat-item { flex: 1; }
        .stat-item:last-child { flex: 1.5; } /* Give more room to the long BTC string */
        
        .stat-item span { font-size: 0.9rem; color: #777; text-transform: uppercase; display: block; margin-bottom: 5px; font-weight: 800; }
        
        .stat-val { 
            font-size: 2.8rem !important; /* BACK TO BIG FONT */
            color: #ffffff; 
            font-family: monospace; 
            display: flex; 
            align-items: center; 
            line-height: 1;
            font-weight: 900;
            letter-spacing: -2px;
            white-space: nowrap;
        }

        .chart-wrapper {
            flex: 1;
            min-height: 0;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            border: 1px solid #1a1a1a;
            position: relative;
            margin-top: 10px;
            padding: 10px;
        }

        .chart-container {
            flex: 1;
            min-height: 0;
            position: relative;
        }

        .tab-buttons { display: flex; gap: 10px; margin-bottom: 10px; }
        .tab-btn { flex: 1; padding: 8px; background: #333; color: #888; border: 1px solid #444; border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 0.85rem; transition: 0.2s; }
        .tab-btn.active { background: var(--btc); color: #000; border-color: var(--btc); }
        .tab-content { display: none; flex-direction: column; min-height: 0; flex: 1; }
        .tab-content.active { display: flex; }

        .mine-btn { background: var(--btc); color: #000; border: none; width: 100%; padding: 20px; font-weight: 900; border-radius: 10px; cursor: pointer; transition: 0.1s; font-size: 1rem; margin-bottom: 15px; }
        .upgrade-list { flex: 1; overflow-y: auto; padding-right: 5px; }
        .u-item { background: #181818; border: 1px solid #252525; border-radius: 10px; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; width: 100%; color: #fff; }

/* 1. THE GENERAL HOVER (Works for all standard miners) */
.u-item:hover:not(:disabled) {
    border-color: var(--btc) !important;
    box-shadow: 0 0 15px rgba(247, 147, 26, 0.4) !important;
    transition: box-shadow 0.2s ease;
}
/* 1. HOVER: Only the main mining button glows */
.mine-btn:hover {
    box-shadow: 0 0 25px rgba(247, 147, 26, 0.6); /* Strong orange glow */
    cursor: pointer;
    filter: brightness(1.1); /* Makes it look slightly 'lit up' */
}

/* 2. CLICK: Only the main mining button moves */
.mine-btn:active {
    transform: scale(0.96) translateY(2px); /* Squishes down and moves slightly */
    box-shadow: 0 0 10px rgba(247, 147, 26, 0.3); /* Shrinks the glow on press */
}

/* Ensure a smooth transition for the effects */
.mine-btn {
    transition: transform 0.05s, box-shadow 0.2s, filter 0.2s;
}
/* 2. MANUAL HASH BASE (The white border) */
#up-0.u-item {
    background: var(--btc) !important;
    border: none !important;
    box-shadow: inset 0 0 0 3px #ffffff !important;
    padding: 15px !important; 
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    border-radius: 10px;
}

/* 3. MANUAL HASH HOVER (The white glow) */
/* We use a comma to keep BOTH the inner white line AND the outer glow */
#up-0.u-item:hover:not(:disabled) {
    background: #ffaa44 !important;
    box-shadow: inset 0 0 0 3px #ffffff, 0 0 20px rgba(255, 255, 255, 0.7) !important;
}

/* 4. KEEP THE TEXT WHITE */
#up-0.u-item #lvl-txt-0 {
    color: #ffffff !important;
}

.u-item:disabled {
    opacity: 0.2;
    cursor: not-allowed;
}

/* Disabled boost buttons styling */
button:disabled {
    cursor: not-allowed !important;
    opacity: 0.5;
}

button:disabled:hover {
    cursor: not-allowed !important;
}

        
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #333; }

        #price-notif-container {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 12px;
            min-width: 60px;
            height: 1.2rem;
        }

        .price-notification {
            position: absolute;
            background: transparent;
            border: none;
            padding: 0;
            color: #fff;
            font-weight: bold;
            font-size: 0.75rem;
            animation: fadeSwitch 2.5s ease forwards;
            font-family: monospace;
            white-space: nowrap;
        }

        .price-notification.up { color: #00ff88; }
        .price-notification.down { color: #ff3344; }

        @keyframes fadeSwitch {
            0% { opacity: 1; }
            85% { opacity: 1; }
            100% { opacity: 0; }
        }

        .offline-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #111;
            border: 2px solid #f7931a;
            border-radius: 12px;
            padding: 30px;
            z-index: 2000;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 0 40px rgba(247, 147, 26, 0.3);
            animation: slideUp 0.4s ease;
        }

        .offline-modal h2 {
            color: #f7931a;
            margin: 0 0 15px 0;
            font-size: 1.8rem;
        }

        .offline-modal .earnings {
            font-size: 2.5rem;
            color: #00ff88;
            font-family: monospace;
            font-weight: bold;
            margin: 15px 0;
        }

        .offline-modal .earnings-label {
            color: #888;
            font-size: 0.9rem;
            text-transform: uppercase;
            margin-bottom: 20px;
        }

        .offline-modal .time-offline {
            color: #666;
            font-size: 0.85rem;
            margin-bottom: 20px;
        }

        .offline-modal button {
            background: #f7931a;
            border: none;
            color: #000;
            padding: 10px 30px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .offline-modal button:hover {
            background: #ffaa33;
            transform: scale(1.05);
        }

        .offline-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1999;
            animation: fadeIn 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translate(-50%, -40%); opacity: 0; }
            to { transform: translate(-50%, -50%); opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>

    <div id="main-layout">
        <div class="panel">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                <span class="nw-label">Portfolio Valuation</span>
                <span style="font-size: 0.6rem; color: #555;">Idle BTC Miner™ 2026 - Aaron Khan</span>
            </div>
            <div class="nw-amount" id="nw-val">$0.00</div>
            <div class="btc-stat">₿ <span id="bal-btc">0.00000000</span></div>

            <div class="mini-stats">
                <div class="stat-item">
                    <span>Hardware Equity</span>
                    <b class="stat-val" id="asset-usd">$0</b>
                </div>
                <div class="stat-item">
                    <span>Hashrate</span>
                    <b class="stat-val" id="yield-btc">0.00/s</b>
                </div>
                <div class="stat-item">
                    <span>Lifetime Mined</span>
                    <b class="stat-val" style="font-size: 48px;">₿<span id="lifetime-btc" style="font-size: 48px; color: white;">0.00013000</span>
</b>

                </div>
            </div>

            <div style="margin-top: 20px; padding: 12px; background: rgba(0,0,0,0.3); border-radius: 8px; border: 1px solid #222;">
                <span style="font-size: 0.85rem; color: #888; text-transform: uppercase; display: block; margin-bottom: 5px;">BTC Price (Virtual price)</span>
                <div style="display: flex; align-items: center;">
                    <b class="stat-val" id="btc-price" style="font-size: 2rem;">$100,000</b>
                    <div id="price-notif-container"></div>
                </div>
            </div>

            <div class="chart-wrapper">
                <canvas id="nwChart"></canvas>
            </div>
        </div>

        <div class="panel" style="display: flex; flex-direction: column; min-height: 0;">
            <button class="mine-btn" onclick="manualHash()">MANUAL HASH<br>
                <span style="font-size: 1.25rem; font-weight: normal; opacity: 0.7;">+0.00000250 ₿</span>
            </button>
            <button id="autoclicker-btn" style="background: #666; color: white; border: none; width: 100%; padding: 10px; font-weight: 700; border-radius: 10px; cursor: pointer; margin-bottom: 10px; font-size: 0.8rem;" onclick="startAutoClicker()">5 clicks/sec • 30s duration • 5m cooldown</button>

            <!-- Power Status Bar -->
            <div style="padding: 12px; background: rgba(0,0,0,0.3); border-radius: 8px; border: 1px solid #222; margin-bottom: 12px;">
                <span style="font-size: 0.85rem; color: #888; text-transform: uppercase; display: block; margin-bottom: 5px;">Power Status</span>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <div style="flex: 1;">
                        <div style="font-size: 0.75rem; color: #00ff88; font-family: monospace; font-weight: 900;" id="power-used">0W / 0W</div>
                        <div id="power-bar" style="height: 8px; background: #222; border-radius: 4px; margin-top: 4px;">
                            <div id="power-bar-fill" style="height: 100%; background: #00ff88; border-radius: 4px; width: 0%;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Buttons -->
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchTab('mining')">MINING</button>
                <button class="tab-btn" onclick="switchTab('power')">POWER</button>
            </div>

            <!-- Mining Tab -->
            <div id="mining-tab" class="tab-content active" style="flex-direction: column; min-height: 0; flex: 1;">
                <div class="upgrade-list" id="shop" style="flex: 1; min-height: 0; overflow-y: auto;"></div>
            </div>

            <!-- Power Tab -->
            <div id="power-tab" class="tab-content" style="flex-direction: column; min-height: 0; flex: 1;">
                <div class="upgrade-list" id="power-shop" style="flex: 1; min-height: 0; overflow-y: auto;"></div>
            </div>

            <!-- Session Stats -->
            <div style="display: flex; gap: 8px; margin-bottom: 10px; margin-top: 10px;">
                <div style="flex: 1; padding: 6px; background: rgba(0,0,0,0.3); border-radius: 6px; border: 1px solid #222;">
                    <span style="font-size: 0.5rem; color: #888; text-transform: uppercase; display: block; margin-bottom: 1px; font-weight: 800;">Time This Session</span>
                    <b id="session-time" style="font-size: 0.75rem; color: #ffffff; font-family: monospace; font-weight: 900;">0m 0s</b>
                </div>
                <div style="flex: 1; padding: 6px; background: rgba(0,0,0,0.3); border-radius: 6px; border: 1px solid #222;">
                    <span style="font-size: 0.5rem; color: #888; text-transform: uppercase; display: block; margin-bottom: 1px; font-weight: 800;">Earnings This Session</span>
                    <b id="session-earnings" style="font-size: 0.75rem; color: #00ff88; font-family: monospace; font-weight: 900;">₿ 0.00000000</b>
                </div>
            </div>

            <div style="display: flex; gap: 10px;">
                <button id="mute-btn" style="background: #888; color: white; border: none; flex: 1; padding: 10px; font-weight: 700; border-radius: 10px; cursor: pointer; font-size: 0.85rem;" onclick="toggleMute()">SOUND ON</button>
                <button style="background: #ff3344; color: white; border: none; flex: 1; padding: 10px; font-weight: 700; border-radius: 10px; cursor: pointer; font-size: 0.85rem;" onclick="resetGame()">RESET SAVE</button>
            </div>
        </div>
    </div>

<script>
    let btcPrice = 100000; // Set manually each day - everyone starts at 100k
    let btcBalance = 0;
    let btcLifetime = 0;
    let btcPerSec = 0;
let btcClickValue = 0.00000250;
    let hardwareEquity = 0;
    let lastTickTime = Date.now();
    const MIN_PRICE = 50000;
    const MAX_PRICE = 200000;
    let lastPriceUpdateTime = 0; // Track when price was last updated
    let manualHashClickTime = 0;
    let manualHashCooldownEnd = 0;
    let clickTimestamps = [];

    // Session tracking
    let sessionStartTime = Date.now();
    let sessionStartBalance = 0;
    let sessionEarnings = 0;

    // Chart history tracking
    let chartHistory = [];
    let chartTimestamps = []; // Track when each data point was added
    let lastChartUpdateTime = Date.now();
    let chartStartTime = Date.now();

    // Power system
    let totalPowerAvailable = 0; // Total watts available
    let totalPowerUsed = 0; // Total watts being used
    const powerUpgrades = [
        { id: 0, name: "Basic PSU", baseUsd: 50, basePower: 100 },
        { id: 1, name: "Standard PSU", baseUsd: 200, basePower: 500 },
        { id: 2, name: "Industrial PSU", baseUsd: 1000, basePower: 2000 },
        { id: 3, name: "Enterprise PSU", baseUsd: 5000, basePower: 10000 },
        { id: 4, name: "Heavy Duty PSU", baseUsd: 25000, basePower: 50000 },
        { id: 5, name: "Mega PSU", baseUsd: 100000, basePower: 200000 }
    ].map(u => ({ ...u, level: 0, currentUsd: u.baseUsd, currentPower: 0 }));

    // Power requirements for mining equipment (in watts)
    const equipmentPowerReqs = {
        0: 0, // Manual hash uses no power
        1: 2.5, // USB Miner
        2: 75, // GTX 1660
        3: 450, // RTX 5090
        4: 1200, // ASIC
        5: 3500, // Liquid ASIC
        6: 12000, // Container
        7: 45000, // Geothermal Farm
        8: 300000, // Data Center
        9: 1500000, // Orbital
        10: 5000000 // Quantum
    };

    // Show price change notification
    function showPriceNotification(oldPrice, newPrice) {
        const change = newPrice - oldPrice;
        const changePercent = ((change / oldPrice) * 100).toFixed(2);
        const isUp = change >= 0;

        const container = document.getElementById('price-notif-container');

        // Remove existing notification if any
        const existing = container.querySelector('.price-notification');
        if (existing) {
            existing.remove();
        }

        const notif = document.createElement('div');
        notif.className = 'price-notification ' + (isUp ? 'up' : 'down');
        notif.innerText = (isUp ? '+' : '') + changePercent + '%';

        container.appendChild(notif);

        setTimeout(() => notif.remove(), 2500);
    }

    // Guaranteed price swings: ±0.01%-1% every 2 seconds, with mean reversion to 100k
    function frequentPriceSwing() {
        let movePercent = (Math.random() * 0.009) + 0.0001; // 0.01% to 1%
        let oldPrice = btcPrice;
        let newPrice = oldPrice * (1 + movePercent);

        // Mean reversion: 60% chance to move towards 100k, 40% chance random walk
        if (Math.random() < 0.6) {
            // Move towards 100k
            const targetPrice = 100000;
            const diff = targetPrice - oldPrice;
            newPrice = oldPrice + (diff * 0.02); // Move 2% towards target
        } else {
            // Random walk
            let direction = Math.random() > 0.5 ? 1 : -1;
            newPrice = oldPrice * (1 + (direction * movePercent));
        }

        btcPrice = Math.max(MIN_PRICE, Math.min(MAX_PRICE, newPrice));

        if (btcPrice !== oldPrice) {
            showPriceNotification(oldPrice, btcPrice);
        }
        updateUI();

        // Schedule next swing every 2 seconds
        setTimeout(frequentPriceSwing, 2000);
    }

    // Occasional big swings: ±2.5%-10% every 5 to 10 minutes
    function bigPriceSwing() {
        let movePercent = (Math.random() * 0.075) + 0.025; // 2.5% to 10%
        let direction = Math.random() > 0.5 ? 1 : -1;
        let move = direction * movePercent;
        let oldPrice = btcPrice;
        let newPrice = btcPrice * (1 + move);

        btcPrice = Math.max(MIN_PRICE, Math.min(MAX_PRICE, newPrice));

        if (btcPrice !== oldPrice) {
            showPriceNotification(oldPrice, btcPrice);
        }
        updateUI();

        // Schedule next big swing randomly between 5 and 10 minutes
        let nextBigSwing = (Math.random() * (600000 - 300000)) + 300000; // 5min to 10min
        setTimeout(bigPriceSwing, nextBigSwing);
    }

    // Sound effects using Web Audio API
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();

    function playClickSound() {
        if (isMuted) return;
        const now = audioContext.currentTime;
        const osc = audioContext.createOscillator();
        const gain = audioContext.createGain();
        osc.connect(gain);
        gain.connect(audioContext.destination);

        osc.frequency.setValueAtTime(800, now);
        osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);
        osc.type = 'sine';

        gain.gain.setValueAtTime(0.05, now);
        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);

        osc.start(now);
        osc.stop(now + 0.1);
    }

    function playUpgradeSound() {
        if (isMuted) return;
        const now = audioContext.currentTime;
        const osc = audioContext.createOscillator();
        const gain = audioContext.createGain();
        osc.connect(gain);
        gain.connect(audioContext.destination);

        osc.frequency.setValueAtTime(500, now);
        osc.frequency.exponentialRampToValueAtTime(1200, now + 0.2);
        osc.type = 'square';

        gain.gain.setValueAtTime(0.04, now);
        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.2);

        osc.start(now);
        osc.stop(now + 0.2);
    }

    const upgrades = [
	{ id: 0, name: "Manual Hash Upgrade", baseUsd: 5, baseYield: 0, isClickUpgrade: true, clickIncrease: 0.00000050 }, // NEW BUTTON
        { id: 1, name: "USB Miner", baseUsd: 5, baseYield: 0.000000115 }, 
        { id: 2, name: "GTX 1660 Super", baseUsd: 100, baseYield: 0.0000007 },
        { id: 3, name: "RTX 5090 Rig", baseUsd: 3000, baseYield: 0.000015 },
        { id: 4, name: "ASIC Mining Unit", baseUsd: 7500, baseYield: 0.000085 },
        { id: 5, name: "Liquid ASIC Rig", baseUsd: 28000, baseYield: 0.00045 },
        { id: 6, name: "Mobile Mining Container", baseUsd: 110000, baseYield: 0.0032 },
        { id: 7, name: "Geothermal Mining Farm", baseUsd: 680000, baseYield: 0.045 },
        { id: 8, name: "Data Center Facility", baseUsd: 5200000, baseYield: 0.62 },
        { id: 9, name: "Orbital Data Relay", baseUsd: 35000000, baseYield: 5.8 },
        { id: 10, name: "Quantum Computer", baseUsd: 500000000, baseYield: 125.0 }
    ].map(u => ({ ...u, level: 0, currentUsd: u.baseUsd, currentYield: 0, boostCost: u.baseUsd * 0.5, boostLevel: 0 }));

    // --- SAVE SYSTEM START ---
    function saveGame() {
        const gameState = {
            btcBalance,
            btcLifetime,
            hardwareEquity,
            btcClickValue,
            btcPerSec,
            lastSaveTime: Date.now(),
            autoClickerCooldownEnd,
            chartHistory: chartHistory,
            chartTimestamps: chartTimestamps,
            chartStartTime: chartStartTime,
            totalPowerAvailable,
            powerUpgrades: powerUpgrades.map(u => ({
                id: u.id,
                level: u.level,
                currentUsd: u.currentUsd,
                currentPower: u.currentPower
            })),
            upgrades: upgrades.map(u => ({
                id: u.id,
                level: u.level,
                currentUsd: u.currentUsd,
                currentYield: u.currentYield,
                boostCost: u.boostCost,
                boostLevel: u.boostLevel
            }))
        };
        localStorage.setItem('satoshiTerminalSave', JSON.stringify(gameState));
    }

function loadGame() {
    const savedData = localStorage.getItem('satoshiTerminalSave');
    if (savedData) {
        const state = JSON.parse(savedData);
        btcBalance = state.btcBalance || 0;
        btcLifetime = state.btcLifetime || 0;
        hardwareEquity = state.hardwareEquity || 0;
        btcClickValue = state.btcClickValue || 0.00000250;

        // Initialize session tracking
        sessionStartBalance = btcBalance;
        // Set chart start time to match when save was made (for accurate timeline)
        chartStartTime = state.chartStartTime || Date.now();

        // Load power upgrades
        if (state.powerUpgrades) {
            state.powerUpgrades.forEach((savedU) => {
                const powerUpgradeToUpdate = powerUpgrades.find(u => u.id === savedU.id);
                if (powerUpgradeToUpdate) {
                    powerUpgradeToUpdate.level = savedU.level || 0;
                    powerUpgradeToUpdate.currentUsd = savedU.currentUsd || powerUpgradeToUpdate.baseUsd;
                    powerUpgradeToUpdate.currentPower = savedU.currentPower || 0;
                }
            });
        }
        totalPowerAvailable = state.totalPowerAvailable || 0;

        // Load upgrades - handle both old saves (by index) and new saves (by id)
        state.upgrades.forEach((savedU, index) => {
            let upgradeToUpdate;
            if (savedU.id !== undefined) {
                // New format: match by id
                upgradeToUpdate = upgrades.find(u => u.id === savedU.id);
            } else {
                // Old format: match by array index
                upgradeToUpdate = upgrades[index];
            }
            if (upgradeToUpdate) {
                upgradeToUpdate.level = savedU.level || 0;
                upgradeToUpdate.currentUsd = savedU.currentUsd || upgradeToUpdate.baseUsd;
                upgradeToUpdate.currentYield = savedU.currentYield || 0;
                upgradeToUpdate.boostCost = savedU.boostCost || upgradeToUpdate.baseUsd * 0.5;
                upgradeToUpdate.boostLevel = savedU.boostLevel || 0;
            }
        });

        // Calculate total power used
        calculateTotalPowerUsed();

        // Recalculate totals
        btcPerSec = upgrades.reduce((sum, item) => sum + (item.currentYield || 0), 0);

        // Restore autoclicker cooldown
        autoClickerCooldownEnd = state.autoClickerCooldownEnd || 0;

        // Calculate offline earnings (max 1 hour of earnings to prevent exploits)
        const lastSaveTime = state.lastSaveTime || Date.now();
        const currentTime = Date.now();
        let offlineSeconds = (currentTime - lastSaveTime) / 1000;
        const offlineSavedRate = state.btcPerSec || 0;
        const maxOfflineSeconds = 3600; // Cap at 1 hour
        if (offlineSeconds > maxOfflineSeconds) offlineSeconds = maxOfflineSeconds;
        const offlineEarnings = offlineSavedRate * offlineSeconds;

        if (offlineEarnings > 0) {
            btcBalance += offlineEarnings;
            btcLifetime += offlineEarnings;
            window.offlineEarningsToShow = {
                amount: offlineEarnings,
                seconds: offlineSeconds
            };
        }

        updateUI();

        // Restore chart history and timestamps
        chartHistory = state.chartHistory || [];
        chartTimestamps = state.chartTimestamps || [];
        chartStartTime = state.chartStartTime || Date.now();

        // Debug log
        console.log('Loaded save:', { btcBalance, hardwareEquity, offlineEarnings, offlineEarningsToShow: window.offlineEarningsToShow, upgradeLevels: upgrades.map(u => `${u.name}: ${u.level}`) });
    }
}
    // --- SAVE SYSTEM END ---

    function calculateTotalPowerUsed() {
        totalPowerUsed = 0;
        upgrades.forEach(u => {
            if (u.level > 0 && equipmentPowerReqs[u.id] !== undefined) {
                totalPowerUsed += equipmentPowerReqs[u.id] * u.level;
            }
        });
    }

    function resetGame() {
        if (confirm('Are you sure you want to reset your entire save? This cannot be undone!')) {
            localStorage.removeItem('satoshiTerminalSave');
            // Reset all variables to defaults
            btcBalance = 0;
            btcLifetime = 0;
            btcPerSec = 0;
            btcClickValue = 0.00000250;
            hardwareEquity = 0;
            // Reset session stats
            sessionStartTime = Date.now();
            sessionStartBalance = 0;
            sessionEarnings = 0;
            // Reset chart history
            chartHistory = [];
            chartTimestamps = [];
            chartStartTime = Date.now();
            // Reset power system
            totalPowerAvailable = 0;
            totalPowerUsed = 0;
            powerUpgrades.forEach(u => {
                u.level = 0;
                u.currentUsd = u.baseUsd;
                u.currentPower = 0;
            });
            // Reset all upgrades
            upgrades.forEach(u => {
                u.level = 0;
                u.currentUsd = u.baseUsd;
                u.currentYield = 0;
            });
            updateUI();
            alert('Game reset! Starting fresh.');
        }
    }

    function showOfflineEarningsModal(btcEarned, secondsOffline) {
        console.log('showOfflineEarningsModal called with:', btcEarned, secondsOffline);

        const overlay = document.createElement('div');
        overlay.className = 'offline-modal-overlay';

        const modal = document.createElement('div');
        modal.className = 'offline-modal';

        const hours = Math.floor(secondsOffline / 3600);
        const minutes = Math.floor((secondsOffline % 3600) / 60);
        const seconds = Math.floor(secondsOffline % 60);

        let timeStr = '';
        if (hours > 0) timeStr += hours + 'h ';
        if (minutes > 0) timeStr += minutes + 'm ';
        if (seconds > 0) timeStr += seconds + 's';
        if (!timeStr) timeStr = '< 1s';

        modal.innerHTML = `
            <h2>⏰ Welcome Back!</h2>
            <div class="earnings-label">Offline Earnings</div>
            <div class="earnings">₿ ${btcEarned.toFixed(8)}</div>
            <div class="time-offline">While you were away for ${timeStr}</div>
            <button id="claim-btn">Claim Rewards</button>
        `;

        document.body.appendChild(overlay);
        document.body.appendChild(modal);

        document.getElementById('claim-btn').onclick = () => {
            overlay.remove();
            modal.remove();
        };

        console.log('Modal created and appended');
    }

    // Sound mute toggle
    let isMuted = false;
    function toggleMute() {
        isMuted = !isMuted;
        const btn = document.getElementById('mute-btn');
        if (btn) {
            btn.innerText = isMuted ? 'SOUND OFF' : 'SOUND ON';
        }
    }

    // Auto-clicker state
    let autoClickerActive = false;
    let autoClickerCooldownEnd = 0;
    const AUTO_CLICKER_DURATION = 30000; // 30 seconds
    const AUTO_CLICKER_COOLDOWN = 300000; // 5 minutes

    function startAutoClicker() {
        if (autoClickerCooldownEnd > Date.now()) {
            return; // Still on cooldown
        }

        autoClickerActive = true;
        autoClickerCooldownEnd = Date.now() + AUTO_CLICKER_COOLDOWN;
        let clicksRemaining = AUTO_CLICKER_DURATION / 200; // 5 clicks/sec = 1 click every 200ms

        const clickInterval = setInterval(() => {
            if (clicksRemaining > 0) {
                manualHash();
                clicksRemaining--;
            } else {
                clearInterval(clickInterval);
                autoClickerActive = false;
                updateAutoClickerButtonState();
            }
        }, 200);

        updateAutoClickerButtonState();
    }

    function updateAutoClickerButtonState() {
        const btn = document.getElementById('autoclicker-btn');
        if (!btn) return;

        const now = Date.now();
        if (autoClickerCooldownEnd > now) {
            const cooldownMs = autoClickerCooldownEnd - now;
            const seconds = Math.ceil(cooldownMs / 1000);
            btn.disabled = true;
            btn.innerText = `COOLDOWN: ${seconds}s`;
        } else {
            btn.disabled = false;
            btn.innerText = '5 clicks/sec • 30s duration • 5m cooldown';
        }
    }

    function initShop() {
        const container = document.getElementById('shop');
        container.innerHTML = '';

        upgrades.forEach((u, i) => {
            const btn = document.createElement('button');
            btn.className = 'u-item';
            btn.id = `up-${u.id}`;
if (u.isClickUpgrade) {
            btn.classList.add('click-upgrade');
        }

        // For manual hash upgrade, clicking upgrades AND applies boost
        if (u.isClickUpgrade) {
            btn.onclick = () => {
                buyLevel(i);
                buyBoost(i);
            };
        } else {
            btn.onclick = () => buyLevel(i);
        }

        const powerReq = equipmentPowerReqs[u.id] || 0;
        const powerDisplay = powerReq > 0 ? `<span style="font-size:0.9rem;color:var(--btc);font-weight:700;display:block;margin-top:3px">${powerReq.toLocaleString()}W per level</span>` : '';

        btn.innerHTML = `
            <div style="text-align:left">
                <span style="font-weight:800;font-size:1.3rem;display:block"><span id="lvl-txt-${u.id}" style="color:var(--btc)">[Lvl 0]</span> ${u.name}</span>
                <span style="font-size:1.2rem;color:var(--green);font-family:monospace" id="yield-${u.id}">+0 ₿/s</span>
                ${powerDisplay}
            </div>
            <div style="text-align:right">
                <span style="font-size:1.16rem;font-weight:900;display:block" id="usd-${u.id}">$${u.baseUsd.toLocaleString()}</span>
                <span style="font-size:1.2rem;color:#666;font-family:monospace" id="btc-cost-${u.id}">₿ 0.00</span>
            </div>`;
        container.appendChild(btn);

        // Add boost button only for non-manual upgrades
        if (!u.isClickUpgrade) {
            const boostBtn = document.createElement('button');
            boostBtn.id = `boost-${u.id}`;
            boostBtn.style.background = '#ff9500';
            boostBtn.style.border = 'none';
            boostBtn.style.borderRadius = '6px';
            boostBtn.style.padding = '6px 10px';
            boostBtn.style.fontSize = '0.7rem';
            boostBtn.style.fontWeight = '700';
            boostBtn.style.color = '#000';
            boostBtn.style.cursor = 'pointer';
            boostBtn.style.marginTop = '2px';
            boostBtn.style.width = '100%';
            boostBtn.style.transition = '0.1s';
            boostBtn.onclick = () => buyBoost(i);
            boostBtn.innerHTML = `+10% HASH RATE | <span id="boost-cost-${u.id}">$0</span>`;
            boostBtn.disabled = u.level === 0;
            boostBtn.setAttribute('data-upgrade-name', u.name);
            container.appendChild(boostBtn);
        }
        });
    }

    function initPowerShop() {
        const container = document.getElementById('power-shop');
        container.innerHTML = '';

        powerUpgrades.forEach((u, i) => {
            const btn = document.createElement('button');
            btn.className = 'u-item';
            btn.id = `pow-${u.id}`;
            btn.onclick = () => buyPowerUpgrade(i);

            const costBtc = u.currentUsd / btcPrice;
            btn.innerHTML = `
                <div style="text-align:left">
                    <span style="font-weight:800;font-size:1.3rem;display:block"><span id="pow-lvl-txt-${u.id}" style="color:var(--btc)">[Lvl ${u.level}]</span> ${u.name}</span>
                    <span style="font-size:1.2rem;color:var(--green);font-family:monospace" id="pow-power-${u.id}">+0W</span>
                </div>
                <div style="text-align:right">
                    <span style="font-size:1.16rem;font-weight:900;display:block" id="pow-usd-${u.id}">$${u.currentUsd.toLocaleString()}</span>
                    <span style="font-size:1.2rem;color:#666;font-family:monospace" id="pow-btc-cost-${u.id}">₿ 0.00</span>
                </div>`;
            container.appendChild(btn);
        });
    }

    function switchTab(tab) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));

        document.getElementById(tab + '-tab').classList.add('active');
        event.target.classList.add('active');
    }

    function buyPowerUpgrade(i) {
        const u = powerUpgrades[i];
        const costBtc = u.currentUsd / btcPrice;

        if (btcBalance >= costBtc) {
            btcBalance -= costBtc;
            hardwareEquity += u.currentUsd;
            u.level++;
            u.currentPower = u.basePower * u.level;
            totalPowerAvailable += u.basePower;

            // Update price with 1.2x multiplier
            u.currentUsd = Math.floor(u.baseUsd * Math.pow(1.2, u.level));

            updateUI();
            saveGame();
            playUpgradeSound();
        }
    }

    function updatePowerDisplay() {
        const powerUsedEl = document.getElementById('power-used');
        if (powerUsedEl) {
            powerUsedEl.innerText = totalPowerUsed.toLocaleString() + 'W / ' + totalPowerAvailable.toLocaleString() + 'W';

            // Dynamic color for power text based on usage
            const percentage = totalPowerAvailable > 0 ? (totalPowerUsed / totalPowerAvailable * 100) : 0;
            if (percentage > 100) {
                powerUsedEl.style.color = '#ff3344'; // Red - over capacity
            } else if (percentage > 80) {
                powerUsedEl.style.color = '#ff9500'; // Orange - critical
            } else if (percentage > 60) {
                powerUsedEl.style.color = '#ffdd00'; // Yellow - warning
            } else {
                powerUsedEl.style.color = '#00ff88'; // Green - safe
            }
        }

        const powerBarFill = document.getElementById('power-bar-fill');
        if (powerBarFill) {
            const percentage = totalPowerAvailable > 0 ? (totalPowerUsed / totalPowerAvailable * 100) : 0;
            powerBarFill.style.width = Math.min(percentage, 100) + '%';

            // Dynamic color for power bar based on usage
            if (percentage > 100) {
                powerBarFill.style.background = '#ff3344'; // Red - over capacity
            } else if (percentage > 80) {
                powerBarFill.style.background = '#ff9500'; // Orange - critical
            } else if (percentage > 60) {
                powerBarFill.style.background = '#ffdd00'; // Yellow - warning
            } else {
                powerBarFill.style.background = '#00ff88'; // Green - safe
            }
        }

        // Update power upgrades display
        powerUpgrades.forEach(u => {
            const costBtc = u.currentUsd / btcPrice;
            const lvlEl = document.getElementById(`pow-lvl-txt-${u.id}`);
            if (lvlEl) lvlEl.innerText = `[Lvl ${u.level}]`;

            const powerEl = document.getElementById(`pow-power-${u.id}`);
            if (powerEl) powerEl.innerText = `+${u.currentPower.toLocaleString()}W`;

            const usdEl = document.getElementById(`pow-usd-${u.id}`);
            if (usdEl) usdEl.innerText = `$${u.currentUsd.toLocaleString()}`;

            const costEl = document.getElementById(`pow-btc-cost-${u.id}`);
            if (costEl) costEl.innerText = '₿ ' + costBtc.toFixed(8);

            const btn = document.getElementById(`pow-${u.id}`);
            if (btn) btn.disabled = (btcBalance < costBtc);
        });
    }

function manualHash() {
    // This adds your current click power to your spendable balance
    btcBalance += btcClickValue;

    // This ensures every manual click also increases your Lifetime Total
    btcLifetime += btcClickValue;

    // Track clicks for hashrate
    const now = Date.now();
    manualHashClickTime = now;
    manualHashCooldownEnd = now + 1000;
    clickTimestamps.push(now);
    if (clickTimestamps.length > 60) clickTimestamps.shift();

    // Play click sound
    playClickSound();

    // This refreshes the screen so you see the numbers go up
    updateUI();
}

function buyLevel(i) {
    const u = upgrades[i];
    const costBtc = u.currentUsd / btcPrice;

    if (btcBalance >= costBtc) {
        // Check power requirements
        const powerReq = equipmentPowerReqs[u.id] || 0;
        const powerNeeded = totalPowerUsed + (powerReq * (u.level + 1));

        if (powerNeeded > totalPowerAvailable && powerReq > 0) {
            alert(`Insufficient power! This upgrade requires ${powerReq.toLocaleString()}W per level.\nYou need ${Math.ceil(powerNeeded - totalPowerAvailable).toLocaleString()}W more power capacity.`);
            return;
        }

        btcBalance -= costBtc;
        hardwareEquity += u.currentUsd;
        u.level++;

        // Check if this is the Manual Hash upgrade
        if (u.id === 0 || u.isClickUpgrade) {
            // Increase click value by 10%
            btcClickValue *= 1.10;

            // FASTER PRICE SCALE: % increase per level
            u.currentUsd = Math.floor(u.baseUsd * Math.pow(1.75, u.level));

            // Update the main orange button text to show new click value
            document.querySelector('.mine-btn span').innerText = `+${btcClickValue.toFixed(8)} ₿`;
        } else {
            // ALL OTHER MINERS: Standard 15% increase
            u.currentYield = u.baseYield * u.level * Math.pow(1.10, u.boostLevel);
            u.currentUsd = Math.floor(u.baseUsd * Math.pow(1.15, u.level));
        }

        btcPerSec = upgrades.reduce((sum, item) => sum + (item.currentYield || 0), 0);
        updateUI();
        saveGame();

        // Play upgrade sound
        playUpgradeSound();
    }
}

function buyBoost(i) {
    const u = upgrades[i];

    // Check if upgrade level is 0 (not purchased yet)
    if (u.level === 0) {
        return; // Cannot boost if upgrade hasn't been purchased
    }

    const costBtc = u.boostCost / btcPrice;

    if (btcBalance >= costBtc) {
        btcBalance -= costBtc;
        hardwareEquity += u.boostCost;
        u.boostLevel++;

        // Increase yield by 10% permanently
        u.currentYield *= 1.10;

        // Double the boost cost for next purchase
        u.boostCost *= 2;

        btcPerSec = upgrades.reduce((sum, item) => sum + (item.currentYield || 0), 0);
        updateUI();
        saveGame();

        // Play upgrade sound
        playUpgradeSound();
    }
}

    function updateSessionStats() {
        // Update session time
        const now = Date.now();
        const sessionSeconds = Math.floor((now - sessionStartTime) / 1000);
        const hours = Math.floor(sessionSeconds / 3600);
        const minutes = Math.floor((sessionSeconds % 3600) / 60);
        const seconds = sessionSeconds % 60;

        let timeStr = '';
        if (hours > 0) timeStr += hours + 'h ';
        if (minutes > 0) timeStr += minutes + 'm ';
        timeStr += seconds + 's';

        document.getElementById('session-time').innerText = timeStr;

        // Update session earnings
        sessionEarnings = btcBalance - sessionStartBalance;
        document.getElementById('session-earnings').innerText = '₿ ' + sessionEarnings.toFixed(8);
    }

    function updateUI() {
        let netWorth = (btcBalance * btcPrice);
        document.getElementById('nw-val').innerText = "$" + netWorth.toLocaleString(undefined, {minimumFractionDigits: 2});
        document.getElementById('bal-btc').innerText = btcBalance.toFixed(8);
        document.getElementById('lifetime-btc').innerText = btcLifetime.toFixed(8);
        document.getElementById('asset-usd').innerText = "$" + Math.floor(hardwareEquity).toLocaleString();
        let displayRate = btcPerSec;
        const now = Date.now();
        if (now < manualHashCooldownEnd && clickTimestamps.length > 0) {
            const timeSpan = now - clickTimestamps[0];
            const cps = timeSpan > 0 ? (clickTimestamps.length / (timeSpan / 1000)) : clickTimestamps.length;
            displayRate = btcPerSec + (btcClickValue * cps);
        } else {
            clickTimestamps = [];
        }
        document.getElementById('yield-btc').innerText = displayRate.toFixed(8) + "/s";
        document.getElementById('lifetime-btc').innerText = btcLifetime.toFixed(8);
        document.getElementById('btc-price').innerText = "$" + Math.floor(btcPrice).toLocaleString();

        // Update session stats
        updateSessionStats();

        // Update power display
        calculateTotalPowerUsed();
        updatePowerDisplay();

 upgrades.forEach(u => {
    const costBtc = u.currentUsd / btcPrice;
    const yEl = document.getElementById(`yield-${u.id}`);

    if (yEl) {
        if (u.isClickUpgrade) {
            yEl.innerText = `+10% MANUAL HASH RATE`;
        } else {
            // Show the current speed
            const currentSpeed = u.baseYield * u.level * Math.pow(1.10, u.boostLevel);
            yEl.innerText = `+${currentSpeed.toFixed(8)} ₿/s - Current Speed`;
        }
    }

    const uEl = document.getElementById(`usd-${u.id}`);
    if(uEl) uEl.innerText = `$${u.currentUsd.toLocaleString()}`;
    const cEl = document.getElementById(`btc-cost-${u.id}`);
    if(cEl) cEl.innerText = "₿ " + costBtc.toFixed(8);

    const bEl = document.getElementById(`up-${u.id}`);
    if(bEl) {
        // Check both BTC balance and power requirements
        const hasEnoughBtc = btcBalance >= costBtc;
        const powerReq = equipmentPowerReqs[u.id] || 0;
        const powerNeeded = totalPowerUsed + (powerReq * (u.level + 1));
        const hasEnoughPower = powerNeeded <= totalPowerAvailable || powerReq === 0;
        bEl.disabled = !(hasEnoughBtc && hasEnoughPower);

        // Change button appearance if power is insufficient
        if (!hasEnoughPower && hasEnoughBtc && powerReq > 0) {
            bEl.style.opacity = '0.6';
            bEl.title = `Insufficient power! Need ${Math.ceil(powerNeeded - totalPowerAvailable).toLocaleString()}W more`;
        } else {
            bEl.style.opacity = '1';
            bEl.title = '';
        }
    }

    const lEl = document.getElementById(`lvl-txt-${u.id}`);
    if(lEl) lEl.innerText = `[Lvl ${u.level}]`;

    // Update boost button
    const boostCostBtc = u.boostCost / btcPrice;
    const boostCostEl = document.getElementById(`boost-cost-${u.id}`);
    if(boostCostEl) boostCostEl.innerText = `$${Math.floor(u.boostCost).toLocaleString()}`;

    // Format the current yield amount (after all boosts applied)
    const currentYield = u.baseYield * u.level * Math.pow(1.10, u.boostLevel);
    const boostAmtEl = document.getElementById(`boost-amt-${u.id}`);
    if(boostAmtEl) {
        if (currentYield >= 1) {
            boostAmtEl.innerText = currentYield.toFixed(2);
        } else if (currentYield >= 0.0001) {
            boostAmtEl.innerText = (currentYield * 1000000).toFixed(0) + 'μ';
        } else if (currentYield > 0) {
            boostAmtEl.innerText = (currentYield * 1000000000).toFixed(0);
        } else {
            boostAmtEl.innerText = '0';
        }
    }

    const boostBtn = document.getElementById(`boost-${u.id}`);
    if(boostBtn) {
        boostBtn.disabled = (u.level === 0 || btcBalance < boostCostBtc);
        if (u.level === 0) {
            boostBtn.innerHTML = `Purchase ${u.name} first`;
        } else {
            boostBtn.innerHTML = `+10% HASH RATE | <span id="boost-cost-${u.id}">$${Math.floor(u.boostCost).toLocaleString()}</span>`;
        }
    }
});
    }

    setInterval(() => {
        const now = Date.now();
        const deltaTime = (now - lastTickTime) / 1000;
        lastTickTime = now;
        if (btcPerSec > 0) {
            let gain = btcPerSec * deltaTime;
            btcBalance += gain;
            btcLifetime += gain;
            updateUI();
        }
        updateAutoClickerButtonState();
    }, 100);

    // Initialize game with manual BTC price
    initShop();
    initPowerShop();
    loadGame(); // This calls updateUI() internally
    updateAutoClickerButtonState(); // Update button state immediately after loading

    const ctx = document.getElementById('nwChart').getContext('2d');

    // Initialize chart with full history (at least one data point)
    const currentNetWorth = btcBalance * btcPrice;
    if (chartHistory.length === 0) {
        chartHistory.push(currentNetWorth);
        chartTimestamps.push({ time: Date.now(), value: currentNetWorth });
        chartStartTime = Date.now();
    }

    const nwChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: chartHistory.map((_, i) => ''),
            datasets: [{
                data: chartHistory,
                borderColor: '#00ff88',
                borderWidth: 4,
                pointRadius: 0,
                fill: true,
                backgroundColor: 'rgba(0, 255, 136, 0.1)',
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: { display: false },
                y: { display: true }
            },
            plugins: { legend: { display: false } }
        }
    });

    setInterval(() => {
        const netWorth = btcBalance * btcPrice;
        chartHistory.push(netWorth);
        chartTimestamps.push({ time: Date.now(), value: netWorth });

        nwChart.data.datasets[0].data = chartHistory;
        nwChart.data.labels = chartHistory.map((_, i) => '');
        nwChart.update('none');
    }, 2000);

    // Auto-save every 1.5 seconds
    setInterval(saveGame, 1500);

    // Show offline earnings if applicable
    console.log('Checking for offline earnings:', window.offlineEarningsToShow);
    if (window.offlineEarningsToShow) {
        if (window.offlineEarningsToShow.amount > 0) {
            console.log('Showing offline earnings modal with:', window.offlineEarningsToShow);
            setTimeout(() => {
                showOfflineEarningsModal(window.offlineEarningsToShow.amount, window.offlineEarningsToShow.seconds);
                window.offlineEarningsToShow = null;
            }, 300);
        } else {
            console.log('Offline earnings was 0 or less:', window.offlineEarningsToShow.amount);
        }
    } else {
        console.log('No offline earnings data stored');
    }

    // Start price swings: frequent small swings every 2 seconds + occasional big swings
    frequentPriceSwing(); // Start frequent swings (±0.5%-2% every 2 seconds)
    bigPriceSwing();      // Start occasional big swings (±5-20% every 5-10 minutes)
</script>

</body>

</html>




