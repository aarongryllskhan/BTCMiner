<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2H559N5J64"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-2H559N5J64');
</script>
    <meta charset="UTF-8">
    <title>Idle BTC Miner | GAME</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --btc: #f7931a; --bg: #050505; --panel: #111; --green: #00ff88; --red: #ff3344; --border: #222; }
        body { font-family: 'Inter', -apple-system, sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 20px; overflow: hidden; height: 100vh; box-sizing: border-box; }
        
        #main-layout { display: grid; grid-template-columns: 7fr 3fr; gap: 20px; height: calc(100vh - 40px); }
        .panel { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; display: flex; flex-direction: column; padding: 24px; position: relative; overflow: hidden; }
        
        .nw-label { font-size: 1.2rem; color: #555; text-transform: uppercase; letter-spacing: 3px; font-weight: 700; }
        .nw-amount { 
            font-size: 4.5rem; 
            font-weight: 950; 
            color: var(--green); 
            font-family: monospace; 
            line-height: 1; 
            margin: 8px 0; 
            letter-spacing: -3px; 
            white-space: nowrap;
        }
        .btc-stat { font-size: 2.2rem; color: var(--btc); font-weight: bold; font-family: monospace; border-bottom: 2px solid var(--border); padding-bottom: 12px; margin-bottom: 25px; }

        /* Restoring the 2-column feel for the first two, but allowing the 3rd to be wide */
        .mini-stats { display: flex; justify-content: space-between; gap: 30px; margin-bottom: 15px; }
        .stat-item { flex: 1; }
        .stat-item:last-child { flex: 1.5; } /* Give more room to the long BTC string */
        
        .stat-item span { font-size: 0.9rem; color: #777; text-transform: uppercase; display: block; margin-bottom: 5px; font-weight: 800; }
        
        .stat-val { 
            font-size: 2.8rem !important; /* BACK TO BIG FONT */
            color: #ffffff; 
            font-family: monospace; 
            display: flex; 
            align-items: center; 
            line-height: 1;
            font-weight: 900;
            letter-spacing: -2px;
            white-space: nowrap;
        }

        .chart-container { 
            flex: 1; 
            min-height: 0; 
            background: rgba(0,0,0,0.3); 
            border-radius: 8px; 
            border: 1px solid #1a1a1a; 
            position: relative;
            margin-top: 10px;
            padding: 10px;
        }

        .mine-btn { background: var(--btc); color: #000; border: none; width: 100%; padding: 20px; font-weight: 900; border-radius: 10px; cursor: pointer; transition: 0.1s; font-size: 1rem; margin-bottom: 15px; }
        .upgrade-list { flex: 1; overflow-y: auto; padding-right: 5px; }
        .u-item { background: #181818; border: 1px solid #252525; border-radius: 10px; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; width: 100%; color: #fff; }

/* 1. THE GENERAL HOVER (Works for all standard miners) */
.u-item:hover:not(:disabled) {
    border-color: var(--btc) !important;
    box-shadow: 0 0 15px rgba(247, 147, 26, 0.4) !important;
    transition: box-shadow 0.2s ease;
}
/* 1. HOVER: Only the main mining button glows */
.mine-btn:hover {
    box-shadow: 0 0 25px rgba(247, 147, 26, 0.6); /* Strong orange glow */
    cursor: pointer;
    filter: brightness(1.1); /* Makes it look slightly 'lit up' */
}

/* 2. CLICK: Only the main mining button moves */
.mine-btn:active {
    transform: scale(0.96) translateY(2px); /* Squishes down and moves slightly */
    box-shadow: 0 0 10px rgba(247, 147, 26, 0.3); /* Shrinks the glow on press */
}

/* Ensure a smooth transition for the effects */
.mine-btn {
    transition: transform 0.05s, box-shadow 0.2s, filter 0.2s;
}
/* 2. MANUAL HASH BASE (The white border) */
#up-0.u-item {
    background: var(--btc) !important;
    border: none !important;
    box-shadow: inset 0 0 0 3px #ffffff !important;
    padding: 15px !important; 
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    border-radius: 10px;
}

/* 3. MANUAL HASH HOVER (The white glow) */
/* We use a comma to keep BOTH the inner white line AND the outer glow */
#up-0.u-item:hover:not(:disabled) {
    background: #ffaa44 !important;
    box-shadow: inset 0 0 0 3px #ffffff, 0 0 20px rgba(255, 255, 255, 0.7) !important;
}

/* 4. KEEP THE TEXT WHITE */
#up-0.u-item #lvl-txt-0 {
    color: #ffffff !important;
}   .u-item:disabled { opacity: 0.2; cursor: not-allowed; }

        
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #333; }

        #price-notif-container {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 12px;
            min-width: 60px;
            height: 1.2rem;
        }

        .price-notification {
            position: absolute;
            background: transparent;
            border: none;
            padding: 0;
            color: #fff;
            font-weight: bold;
            font-size: 0.75rem;
            animation: fadeSwitch 2.5s ease forwards;
            font-family: monospace;
            white-space: nowrap;
        }

        .price-notification.up { color: #00ff88; }
        .price-notification.down { color: #ff3344; }

        @keyframes fadeSwitch {
            0% { opacity: 1; }
            85% { opacity: 1; }
            100% { opacity: 0; }
        }

        .offline-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #111;
            border: 2px solid #f7931a;
            border-radius: 12px;
            padding: 30px;
            z-index: 2000;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 0 40px rgba(247, 147, 26, 0.3);
            animation: slideUp 0.4s ease;
        }

        .offline-modal h2 {
            color: #f7931a;
            margin: 0 0 15px 0;
            font-size: 1.8rem;
        }

        .offline-modal .earnings {
            font-size: 2.5rem;
            color: #00ff88;
            font-family: monospace;
            font-weight: bold;
            margin: 15px 0;
        }

        .offline-modal .earnings-label {
            color: #888;
            font-size: 0.9rem;
            text-transform: uppercase;
            margin-bottom: 20px;
        }

        .offline-modal .time-offline {
            color: #666;
            font-size: 0.85rem;
            margin-bottom: 20px;
        }

        .offline-modal button {
            background: #f7931a;
            border: none;
            color: #000;
            padding: 10px 30px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .offline-modal button:hover {
            background: #ffaa33;
            transform: scale(1.05);
        }

        .offline-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1999;
            animation: fadeIn 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translate(-50%, -40%); opacity: 0; }
            to { transform: translate(-50%, -50%); opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>

    <div id="main-layout">
        <div class="panel">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                <span class="nw-label">Portfolio Valuation</span>
                <span style="font-size: 0.6rem; color: #555;">Idle BTC Miner‚Ñ¢ 2026 - Aaron Khan</span>
            </div>
            <div class="nw-amount" id="nw-val">$0.00</div>
            <div class="btc-stat">‚Çø <span id="bal-btc">0.00000000</span></div>

            <div class="mini-stats">
                <div class="stat-item">
                    <span>Hardware Equity</span>
                    <b class="stat-val" id="asset-usd">$0</b>
                </div>
                <div class="stat-item">
                    <span>Hashrate</span>
                    <b class="stat-val" id="yield-btc">0.00/s</b>
                </div>
                <div class="stat-item">
                    <span>Lifetime Mined</span>
                    <b class="stat-val" style="font-size: 48px;">‚Çø<span id="lifetime-btc" style="font-size: 48px; color: white;">0.00013000</span>
</b>

                </div>
            </div>

            <div style="margin-top: 20px; padding: 12px; background: rgba(0,0,0,0.3); border-radius: 8px; border: 1px solid #222;">
                <span style="font-size: 0.85rem; color: #888; text-transform: uppercase; display: block; margin-bottom: 5px;">BTC Price (Virtual price)</span>
                <div style="display: flex; align-items: center;">
                    <b class="stat-val" id="btc-price" style="font-size: 2rem;">$100,000</b>
                    <div id="price-notif-container"></div>
                </div>
            </div>

            <div style="margin-top: 8px; padding: 4px 6px; background: rgba(0,0,0,0.3); border-radius: 6px; border: 1px solid #222;">
                <span style="font-size: 0.65rem; color: #888; text-transform: uppercase; display: block; line-height: 1;">Blockchain Reward</span>
                <b class="stat-val" id="blockchain-multiplier" style="font-size: 0.65rem; line-height: 1;">100%</b>
            </div>

            <div class="chart-container">
                <canvas id="nwChart"></canvas>
            </div>
        </div>

        <div class="panel">
            <button class="mine-btn" onclick="manualHash()">MANUAL HASH<br>
                <span style="font-size: 1.25rem; font-weight: normal; opacity: 0.7;">+0.00000250 ‚Çø</span>
            </button>

            <button id="auto-click-btn" title="Clicks 5 times per second for 30 seconds. 5 minute cooldown." style="background: #ffaa44; color: #000; border: none; width: 100%; padding: 12px; font-weight: 900; border-radius: 10px; cursor: pointer; transition: 0.1s; font-size: 0.9rem; margin-bottom: 8px;" onclick="startAutoClicker()">AUTO-CLICKER</button>
            <div style="background: rgba(255, 170, 68, 0.15); border: 1px solid #ffaa44; border-radius: 6px; padding: 8px; font-size: 0.7rem; color: #aaa; text-align: center; margin-bottom: 15px; line-height: 1.4;">
                <span style="display: block; color: #ffaa44; font-weight: 700;">5 clicks/sec ‚Ä¢ 30s duration ‚Ä¢ 5m cooldown</span>
            </div>

            <div style="display: flex; gap: 6px; margin: 12px 0; justify-content: center;">
                <button onclick="setBuyMultiplier(1)" id="mult-1" style="background: #333; border: 1px solid #555; color: #fff; padding: 6px 10px; border-radius: 4px; font-weight: 700; cursor: pointer; font-size: 0.75rem;">1x</button>
                <button onclick="setBuyMultiplier(5)" id="mult-5" style="background: #333; border: 1px solid #555; color: #fff; padding: 6px 10px; border-radius: 4px; font-weight: 700; cursor: pointer; font-size: 0.75rem;">5x</button>
                <button onclick="setBuyMultiplier(10)" id="mult-10" style="background: #333; border: 1px solid #555; color: #fff; padding: 6px 10px; border-radius: 4px; font-weight: 700; cursor: pointer; font-size: 0.75rem;">10x</button>
                <button onclick="setBuyMultiplier(25)" id="mult-25" style="background: #333; border: 1px solid #555; color: #fff; padding: 6px 10px; border-radius: 4px; font-weight: 700; cursor: pointer; font-size: 0.75rem;">25x</button>
                <button onclick="setBuyMultiplier(100)" id="mult-100" style="background: #333; border: 1px solid #555; color: #fff; padding: 6px 10px; border-radius: 4px; font-weight: 700; cursor: pointer; font-size: 0.75rem;">100x</button>
            </div>

            <div class="upgrade-list" id="shop"></div>

            <div style="display: flex; gap: 8px; margin-top: 12px;">
                <button id="mute-btn" style="background: #666; color: white; border: none; flex: 1; padding: 8px; font-weight: 700; border-radius: 8px; cursor: pointer; font-size: 0.8rem;" onclick="toggleMute()">üîä SOUND ON</button>
                <button style="background: #ff3344; color: white; border: none; flex: 1; padding: 8px; font-weight: 700; border-radius: 8px; cursor: pointer; font-size: 0.8rem;" onclick="resetGame()">RESET SAVE</button>
            </div>
        </div>
    </div>

<script>
    let btcPrice = 100000; // Set manually each day - everyone starts at 100k
    let btcBalance = 0;
    let btcLifetime = 0;
    let btcPerSec = 0;
let btcClickValue = 0.00000250;
    let hardwareEquity = 0;
    let lastTickTime = Date.now();
    const MIN_PRICE = 50000;
    const MAX_PRICE = 200000;
    let lastPriceUpdateTime = 0; // Track when price was last updated
    let blockchainRewardMultiplier = 1.0; // Starts at 100%, reduces by 5% per whole BTC
    let lastRewardCheckBtc = 0; // Track last BTC amount we checked for reward halving
    let buyMultiplier = 1; // Buy multiplier: 1x, 5x, 10x, etc.
    let isMuted = false; // Mute toggle for sounds
    let autoClickerActive = false; // Is auto-clicker running
    let autoClickerCooldownEnd = 0; // When cooldown ends (timestamp)

    // Show price change notification
    function showPriceNotification(oldPrice, newPrice) {
        const change = newPrice - oldPrice;
        const changePercent = ((change / oldPrice) * 100).toFixed(2);
        const isUp = change >= 0;

        const container = document.getElementById('price-notif-container');

        // Remove existing notification if any
        const existing = container.querySelector('.price-notification');
        if (existing) {
            existing.remove();
        }

        const notif = document.createElement('div');
        notif.className = 'price-notification ' + (isUp ? 'up' : 'down');
        notif.innerText = (isUp ? '+' : '') + changePercent + '%';

        container.appendChild(notif);

        setTimeout(() => notif.remove(), 2500);
    }

    // Guaranteed price swings: ¬±0.01%-1% every 2 seconds, with mean reversion to 100k
    function frequentPriceSwing() {
        let movePercent = (Math.random() * 0.009) + 0.0001; // 0.01% to 1%
        let oldPrice = btcPrice;
        let newPrice = oldPrice * (1 + movePercent);

        // Mean reversion: 60% chance to move towards 100k, 40% chance random walk
        if (Math.random() < 0.6) {
            // Move towards 100k
            const targetPrice = 100000;
            const diff = targetPrice - oldPrice;
            newPrice = oldPrice + (diff * 0.02); // Move 2% towards target
        } else {
            // Random walk
            let direction = Math.random() > 0.5 ? 1 : -1;
            newPrice = oldPrice * (1 + (direction * movePercent));
        }

        btcPrice = Math.max(MIN_PRICE, Math.min(MAX_PRICE, newPrice));

        if (btcPrice !== oldPrice) {
            showPriceNotification(oldPrice, btcPrice);
        }
        updateUI();

        // Schedule next swing every 2 seconds
        setTimeout(frequentPriceSwing, 2000);
    }

    // Occasional big swings: ¬±2.5%-10% every 5 to 10 minutes
    function bigPriceSwing() {
        let movePercent = (Math.random() * 0.075) + 0.025; // 2.5% to 10%
        let direction = Math.random() > 0.5 ? 1 : -1;
        let move = direction * movePercent;
        let oldPrice = btcPrice;
        let newPrice = btcPrice * (1 + move);

        btcPrice = Math.max(MIN_PRICE, Math.min(MAX_PRICE, newPrice));

        if (btcPrice !== oldPrice) {
            showPriceNotification(oldPrice, btcPrice);
        }
        updateUI();

        // Schedule next big swing randomly between 5 and 10 minutes
        let nextBigSwing = (Math.random() * (600000 - 300000)) + 300000; // 5min to 10min
        setTimeout(bigPriceSwing, nextBigSwing);
    }

    // Check for blockchain reward halving (5% reduction per whole BTC mined)
    function checkBlockchainRewardHalving() {
        const wholeBtcMined = Math.floor(btcLifetime);
        const btcSinceLast = wholeBtcMined - lastRewardCheckBtc;

        if (btcSinceLast > 0) {
            // Apply 5% reduction for each whole BTC mined
            for (let i = 0; i < btcSinceLast; i++) {
                blockchainRewardMultiplier *= 0.95; // 5% reduction each time
            }
            lastRewardCheckBtc = wholeBtcMined;

            // Show notification of reward reduction
            const reductionPercent = ((1 - blockchainRewardMultiplier) * 100).toFixed(1);
            showRewardHalvingNotification(wholeBtcMined, reductionPercent);
        }
    }

    function showRewardHalvingNotification(btcMilestone, reductionPercent) {
        const notif = document.createElement('div');
        notif.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #111; border: 2px solid #ff6b35; border-radius: 8px; padding: 12px 16px; text-align: center; z-index: 2000; color: #fff; font-weight: bold; font-family: monospace; max-width: 220px; box-shadow: 0 0 30px rgba(255, 107, 53, 0.4); animation: slideUp 0.4s ease;';
        notif.innerHTML = `
            <div style="font-size: 0.95rem; color: #ff6b35; margin-bottom: 6px;">‚õìÔ∏è BLOCKCHAIN REWARD</div>
            <div style="font-size: 0.8rem; color: #ff3344;">-5% @ ${btcMilestone}‚Çø</div>
            <div style="font-size: 0.7rem; color: #666; margin-top: 4px;">${(blockchainRewardMultiplier * 100).toFixed(1)}% efficiency</div>
        `;
        document.body.appendChild(notif);

        setTimeout(() => notif.remove(), 4000);
    }

    // Sound effects using Web Audio API
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();

    function toggleMute() {
        isMuted = !isMuted;
        const muteBtn = document.getElementById('mute-btn');
        if (isMuted) {
            muteBtn.innerText = 'üîá SOUND OFF';
            muteBtn.style.background = '#444';
        } else {
            muteBtn.innerText = 'üîä SOUND ON';
            muteBtn.style.background = '#666';
        }
    }

    function playClickSound() {
        if (isMuted) return;

        const now = audioContext.currentTime;
        const osc = audioContext.createOscillator();
        const gain = audioContext.createGain();
        osc.connect(gain);
        gain.connect(audioContext.destination);

        osc.frequency.setValueAtTime(800, now);
        osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);
        osc.type = 'sine';

        gain.gain.setValueAtTime(0.05, now);
        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);

        osc.start(now);
        osc.stop(now + 0.1);
    }

    function playUpgradeSound() {
        if (isMuted) return;

        const now = audioContext.currentTime;
        const osc = audioContext.createOscillator();
        const gain = audioContext.createGain();
        osc.connect(gain);
        gain.connect(audioContext.destination);

        osc.frequency.setValueAtTime(500, now);
        osc.frequency.exponentialRampToValueAtTime(1200, now + 0.2);
        osc.type = 'square';

        gain.gain.setValueAtTime(0.04, now);
        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.2);

        osc.start(now);
        osc.stop(now + 0.2);
    }

    const upgrades = [
	{ id: 0, name: "Manual Hash Upgrade", baseUsd: 5, baseYield: 0, isClickUpgrade: true, clickIncrease: 0.00000050 }, // NEW BUTTON
        { id: 1, name: "USB Miner", baseUsd: 5, baseYield: 0.000000115 }, 
        { id: 2, name: "GTX 1660 Super", baseUsd: 100, baseYield: 0.0000007 },
        { id: 3, name: "RTX 5090 Rig", baseUsd: 3000, baseYield: 0.000015 },
        { id: 4, name: "ASIC Mining Unit", baseUsd: 7500, baseYield: 0.000085 },
        { id: 5, name: "Liquid ASIC Rig", baseUsd: 28000, baseYield: 0.00045 },
        { id: 6, name: "Mobile Mining Container", baseUsd: 110000, baseYield: 0.0032 },
        { id: 7, name: "Geothermal Mining Farm", baseUsd: 680000, baseYield: 0.045 },
        { id: 8, name: "Data Center Facility", baseUsd: 5200000, baseYield: 0.62 },
        { id: 9, name: "Orbital Data Relay", baseUsd: 35000000, baseYield: 5.8 },
        { id: 10, name: "Quantum Computer", baseUsd: 500000000, baseYield: 125.0 }
    ].map(u => ({ ...u, level: 0, currentUsd: u.baseUsd, currentYield: 0, boostCost: u.baseUsd * 0.5, boostLevel: 0 }));

    // --- SAVE SYSTEM START ---
    function saveGame() {
        const gameState = {
            btcBalance,
            btcLifetime,
            hardwareEquity,
            btcClickValue,
            btcPerSec,
            blockchainRewardMultiplier,
            lastRewardCheckBtc,
            autoClickerCooldownEnd,
            lastSaveTime: Date.now(),
            chartData: nwChart.data.datasets[0].data.slice(),
            upgrades: upgrades.map(u => ({
                id: u.id,
                level: u.level,
                currentUsd: u.currentUsd,
                currentYield: u.currentYield,
                boostCost: u.boostCost,
                boostLevel: u.boostLevel
            }))
        };
        localStorage.setItem('satoshiTerminalSave', JSON.stringify(gameState));
    }

function loadGame() {
    const savedData = localStorage.getItem('satoshiTerminalSave');
    if (savedData) {
        const state = JSON.parse(savedData);
        btcBalance = state.btcBalance || 0;
        btcLifetime = state.btcLifetime || 0;
        hardwareEquity = state.hardwareEquity || 0;
        btcClickValue = state.btcClickValue || 0.00000250;

        // Load upgrades - handle both old saves (by index) and new saves (by id)
        state.upgrades.forEach((savedU, index) => {
            let upgradeToUpdate;
            if (savedU.id !== undefined) {
                // New format: match by id
                upgradeToUpdate = upgrades.find(u => u.id === savedU.id);
            } else {
                // Old format: match by array index
                upgradeToUpdate = upgrades[index];
            }
            if (upgradeToUpdate) {
                upgradeToUpdate.level = savedU.level || 0;
                upgradeToUpdate.currentUsd = savedU.currentUsd || upgradeToUpdate.baseUsd;
                upgradeToUpdate.currentYield = savedU.currentYield || 0;
                upgradeToUpdate.boostCost = savedU.boostCost || upgradeToUpdate.baseUsd * 0.5;
                upgradeToUpdate.boostLevel = savedU.boostLevel || 0;
            }
        });

        // Recalculate totals
        btcPerSec = upgrades.reduce((sum, item) => sum + (item.currentYield || 0), 0);

        // Restore blockchain difficulty multiplier
        blockchainRewardMultiplier = state.blockchainRewardMultiplier || 1.0;
        lastRewardCheckBtc = state.lastRewardCheckBtc || 0;
        btcPerSec *= blockchainRewardMultiplier;

        // Restore auto-clicker cooldown
        autoClickerCooldownEnd = state.autoClickerCooldownEnd || 0;

        // Calculate offline earnings (max 1 hour of earnings to prevent exploits)
        const lastSaveTime = state.lastSaveTime || Date.now();
        const currentTime = Date.now();
        let offlineSeconds = (currentTime - lastSaveTime) / 1000;
        const offlineSavedRate = state.btcPerSec || 0;
        const maxOfflineSeconds = 3600; // Cap at 1 hour
        if (offlineSeconds > maxOfflineSeconds) offlineSeconds = maxOfflineSeconds;
        const offlineEarnings = offlineSavedRate * offlineSeconds;

        if (offlineEarnings > 0) {
            btcBalance += offlineEarnings;
            btcLifetime += offlineEarnings;
            window.offlineEarningsToShow = {
                amount: offlineEarnings,
                seconds: offlineSeconds
            };
        }


        updateUI();

        // Store chart data to restore after chart initialization
        window.savedChartData = state.chartData || null;

        // Debug log
        console.log('Loaded save:', { btcBalance, hardwareEquity, offlineEarnings, offlineEarningsToShow: window.offlineEarningsToShow, upgradeLevels: upgrades.map(u => `${u.name}: ${u.level}`) });
    }
}
    // --- SAVE SYSTEM END ---

    function resetGame() {
        if (confirm('Are you sure you want to reset your entire save? This cannot be undone!')) {
            localStorage.removeItem('satoshiTerminalSave');
            // Reset all variables to defaults
            btcBalance = 0;
            btcLifetime = 0;
            btcPerSec = 0;
            btcClickValue = 0.00000250;
            hardwareEquity = 0;
            // Reset all upgrades
            upgrades.forEach(u => {
                u.level = 0;
                u.currentUsd = u.baseUsd;
                u.currentYield = 0;
            });
            updateUI();
            alert('Game reset! Starting fresh.');
        }
    }

    function showOfflineEarningsModal(btcEarned, secondsOffline) {
        console.log('showOfflineEarningsModal called with:', btcEarned, secondsOffline);

        const overlay = document.createElement('div');
        overlay.className = 'offline-modal-overlay';

        const modal = document.createElement('div');
        modal.className = 'offline-modal';

        const hours = Math.floor(secondsOffline / 3600);
        const minutes = Math.floor((secondsOffline % 3600) / 60);
        const seconds = Math.floor(secondsOffline % 60);

        let timeStr = '';
        if (hours > 0) timeStr += hours + 'h ';
        if (minutes > 0) timeStr += minutes + 'm ';
        if (seconds > 0) timeStr += seconds + 's';
        if (!timeStr) timeStr = '< 1s';

        modal.innerHTML = `
            <h2>‚è∞ Welcome Back!</h2>
            <div class="earnings-label">Offline Earnings</div>
            <div class="earnings">‚Çø ${btcEarned.toFixed(8)}</div>
            <div class="time-offline">While you were away for ${timeStr}</div>
            <button id="claim-btn">Claim Rewards</button>
        `;

        document.body.appendChild(overlay);
        document.body.appendChild(modal);

        document.getElementById('claim-btn').onclick = () => {
            overlay.remove();
            modal.remove();
        };

        console.log('Modal created and appended');
    }

    function initShop() {
        const container = document.getElementById('shop');
        container.innerHTML = ''; 
        upgrades.forEach((u, i) => {
            const btn = document.createElement('button');
            btn.className = 'u-item';
            btn.id = `up-${u.id}`;
if (u.isClickUpgrade) {
            btn.classList.add('click-upgrade');
        }

        // For manual hash upgrade, clicking upgrades AND applies boost
        if (u.isClickUpgrade) {
            btn.onclick = () => {
                buyLevel(i);
                buyBoost(i);
            };
        } else {
            btn.onclick = () => buyLevel(i);
        }

        btn.innerHTML = `
            <div style="text-align:left">
                <span style="font-weight:800;font-size:1.3rem;display:block"><span id="lvl-txt-${u.id}" style="color:var(--btc)">[Lvl 0]</span> ${u.name}</span>
                <span style="font-size:1.2rem;color:var(--green);font-family:monospace" id="yield-${u.id}">+0 ‚Çø/s</span>
            </div>
            <div style="text-align:right">
                <span style="font-size:1.16rem;font-weight:900;display:block" id="usd-${u.id}">$${u.baseUsd.toLocaleString()}</span>
                <span style="font-size:1.2rem;color:#666;font-family:monospace" id="btc-cost-${u.id}">‚Çø 0.00</span>
            </div>`;
        container.appendChild(btn);

        // Add boost button only for non-manual upgrades
        if (!u.isClickUpgrade) {
            const boostBtn = document.createElement('button');
            boostBtn.id = `boost-${u.id}`;
            boostBtn.style.background = '#ff9500';
            boostBtn.style.border = 'none';
            boostBtn.style.borderRadius = '6px';
            boostBtn.style.padding = '6px 10px';
            boostBtn.style.fontSize = '0.7rem';
            boostBtn.style.fontWeight = '700';
            boostBtn.style.color = '#000';
            boostBtn.style.cursor = 'pointer';
            boostBtn.style.marginTop = '2px';
            boostBtn.style.width = '100%';
            boostBtn.style.transition = '0.1s';

            // Check if upgrade is unlocked (level > 0)
            if (u.level > 0) {
                boostBtn.onclick = () => {
                    console.log('Boost button clicked for upgrade ID:', u.id);
                    buyBoost(upgrades.findIndex(up => up.id === u.id));
                };
                boostBtn.innerHTML = `+10% HASH RATE | <span id="boost-cost-${u.id}">$0</span>`;
            } else {
                boostBtn.disabled = true;
                boostBtn.style.background = '#444';
                boostBtn.style.color = '#888';
                boostBtn.style.cursor = 'not-allowed';
                boostBtn.innerHTML = `PURCHASE ${u.name.replace(/\s+/g,' ').toUpperCase()} FIRST`;
            }
            container.appendChild(boostBtn);
        }
        });
    }

function manualHash() {
    // This adds your current click power to your spendable balance
    btcBalance += btcClickValue;

    // This ensures every manual click also increases your Lifetime Total
    btcLifetime += btcClickValue;

    // Play click sound
    playClickSound();

    // This refreshes the screen so you see the numbers go up
    updateUI();
}

function updateAutoClickerButtonState() {
    const autoClickBtn = document.getElementById('auto-click-btn');
    if (!autoClickBtn) return;

    const now = Date.now();
    if (autoClickerCooldownEnd > now) {
        const remaining = Math.ceil((autoClickerCooldownEnd - now) / 1000);
        autoClickBtn.innerText = `COOLDOWN: ${remaining}s`;
        autoClickBtn.style.background = '#666';
        autoClickBtn.disabled = true;
    } else {
        autoClickBtn.innerText = 'AUTO-CLICKER';
        autoClickBtn.style.background = '#ffaa44';
        autoClickBtn.disabled = false;
    }
}

function startAutoClicker() {
    const now = Date.now();

    // Check if cooldown is still active
    if (autoClickerCooldownEnd > now) {
        const cooldownMs = autoClickerCooldownEnd - now;
        const cooldownSec = Math.ceil(cooldownMs / 1000);
        alert(`Auto-Clicker is on cooldown for ${cooldownSec} more seconds`);
        return;
    }

    if (autoClickerActive) {
        return; // Already running
    }

    autoClickerActive = true;
    const autoClickBtn = document.getElementById('auto-click-btn');
    autoClickBtn.innerText = 'AUTO-CLICKER ACTIVE';
    autoClickBtn.disabled = true;
    autoClickBtn.style.background = '#666';

    const clicksPerSec = 5;
    const intervalMs = 1000 / clicksPerSec; // 200ms between clicks
    const durationMs = 30000; // 30 seconds
    const endTime = Date.now() + durationMs;

    const clickInterval = setInterval(() => {
        if (Date.now() >= endTime) {
            clearInterval(clickInterval);
            autoClickerActive = false;
            autoClickerCooldownEnd = Date.now() + (5 * 60 * 1000); // 5 minute cooldown

            // Update button for cooldown
            const cooldownInterval = setInterval(() => {
                const remaining = Math.ceil((autoClickerCooldownEnd - Date.now()) / 1000);
                if (remaining <= 0) {
                    autoClickBtn.innerText = 'AUTO-CLICKER';
                    autoClickBtn.disabled = false;
                    autoClickBtn.style.background = '#ffaa44';
                    clearInterval(cooldownInterval);
                } else {
                    autoClickBtn.innerText = `COOLDOWN: ${remaining}s`;
                    autoClickBtn.style.background = '#666';
                }
            }, 1000);

            return;
        }

        manualHash();
    }, intervalMs);
}

    function setBuyMultiplier(mult) {
        buyMultiplier = mult;
        // Update button styles
        document.querySelectorAll('[id^="mult-"]').forEach(btn => btn.style.background = '#333');
        document.querySelectorAll('[id^="mult-"]').forEach(btn => btn.style.borderColor = '#555');
        document.getElementById(`mult-${mult}`).style.background = '#f7931a';
        document.getElementById(`mult-${mult}`).style.borderColor = '#f7931a';
    }

    // Initialize with 1x selected by default
    setBuyMultiplier(1);

function buyLevel(i) {
    const u = upgrades[i];

    let purchaseCount = 0;
    for (let x = 0; x < buyMultiplier; x++) {
        // Calculate current cost BEFORE purchase
        const currentCostBtc = u.currentUsd / btcPrice;

        if (btcBalance >= currentCostBtc) {
            btcBalance -= currentCostBtc;
            hardwareEquity += u.currentUsd;
            u.level++;
            purchaseCount++;

            // Check if this is the Manual Hash upgrade
            if (u.id === 0 || u.isClickUpgrade) {
                // Increase click value by 10%
                btcClickValue *= 1.10;

                // FASTER PRICE SCALE: % increase per level
                u.currentUsd = Math.floor(u.baseUsd * Math.pow(1.75, u.level));

                // Update the main orange button text to show new click value
                document.querySelector('.mine-btn span').innerText = `+${btcClickValue.toFixed(8)} ‚Çø`;
            } else {
                // ALL OTHER MINERS: Standard 15% increase
                u.currentYield = u.baseYield * u.level * Math.pow(1.10, u.boostLevel);
                u.currentUsd = Math.floor(u.baseUsd * Math.pow(1.15, u.level));
            }
        } else {
            break; // Stop if not enough BTC
        }
    }

    if (purchaseCount > 0) {
        btcPerSec = upgrades.reduce((sum, item) => sum + (item.currentYield || 0), 0);
        btcPerSec *= blockchainRewardMultiplier; // Apply blockchain difficulty multiplier
        updateUI();
        checkBlockchainRewardHalving(); // Check if we hit a new BTC milestone
        saveGame();

        // Play upgrade sound
        playUpgradeSound();
    }
}

function buyBoost(i) {
    console.log('buyBoost called for upgrade', i);
    const u = upgrades[i];
    const costBtc = u.boostCost / btcPrice;
    console.log('Cost in BTC:', costBtc, 'Balance:', btcBalance, 'Can afford:', btcBalance >= costBtc);

    if (btcBalance >= costBtc) {
        btcBalance -= costBtc;
        hardwareEquity += u.boostCost;
        u.boostLevel++;

        // Increase yield by 10% permanently
        u.currentYield *= 1.10;

        // Double the boost cost for next purchase
        u.boostCost *= 2;

        btcPerSec = upgrades.reduce((sum, item) => sum + (item.currentYield || 0), 0);
        btcPerSec *= blockchainRewardMultiplier; // Apply blockchain difficulty multiplier
        updateUI();
        checkBlockchainRewardHalving(); // Check if we hit a new BTC milestone
        saveGame();

        // Play upgrade sound
        playUpgradeSound();
        console.log('Boost purchased! New boost level:', u.boostLevel);
    } else {
        console.log('Not enough BTC for boost');
    }
}

    function updateUI() {
        let netWorth = (btcBalance * btcPrice); 
        document.getElementById('nw-val').innerText = "$" + netWorth.toLocaleString(undefined, {minimumFractionDigits: 2});
        document.getElementById('bal-btc').innerText = btcBalance.toFixed(8);
        document.getElementById('lifetime-btc').innerText = btcLifetime.toFixed(8);
        document.getElementById('asset-usd').innerText = "$" + Math.floor(hardwareEquity).toLocaleString();
        document.getElementById('yield-btc').innerText = btcPerSec.toFixed(8) + "/s";
        document.getElementById('lifetime-btc').innerText = btcLifetime.toFixed(8);
        document.getElementById('btc-price').innerText = "$" + Math.floor(btcPrice).toLocaleString();
        document.getElementById('blockchain-multiplier').innerText = (blockchainRewardMultiplier * 100).toFixed(1) + "%";

 upgrades.forEach(u => {
    const costBtc = u.currentUsd / btcPrice;
    const yEl = document.getElementById(`yield-${u.id}`);

    if (yEl) {
        if (u.isClickUpgrade) {
            yEl.innerText = `+10% MANUAL HASH RATE`;
        } else {
            // Show the current speed
            const currentSpeed = u.baseYield * u.level * Math.pow(1.10, u.boostLevel);
            yEl.innerText = `+${currentSpeed.toFixed(8)} ‚Çø/s - Current Speed`;
        }
    }

    const uEl = document.getElementById(`usd-${u.id}`);
    if(uEl) uEl.innerText = `$${u.currentUsd.toLocaleString()}`;
    const cEl = document.getElementById(`btc-cost-${u.id}`);
    if(cEl) cEl.innerText = "‚Çø " + costBtc.toFixed(8);
    const bEl = document.getElementById(`up-${u.id}`);
    if(bEl) bEl.disabled = (btcBalance < costBtc);
    const lEl = document.getElementById(`lvl-txt-${u.id}`);
    if(lEl) lEl.innerText = `[Lvl ${u.level}]`;

    // Update boost button
    const boostBtn = document.getElementById(`boost-${u.id}`);
    if (boostBtn) {
        if (u.level > 0) {
            // Upgrade is unlocked, show cost and enable/disable based on balance
            const boostCostBtc = u.boostCost / btcPrice;
            const boostCostEl = document.getElementById(`boost-cost-${u.id}`);
            if(boostCostEl) boostCostEl.innerText = `$${Math.floor(u.boostCost).toLocaleString()}`;

            const hasEnoughBtc = btcBalance >= boostCostBtc;
            boostBtn.disabled = !hasEnoughBtc;
            boostBtn.style.background = !hasEnoughBtc ? '#666' : '#ff9500';
            boostBtn.style.color = !hasEnoughBtc ? '#888' : '#000';
            boostBtn.style.cursor = !hasEnoughBtc ? 'not-allowed' : 'pointer';
            boostBtn.innerHTML = `+10% HASH RATE | <span id="boost-cost-${u.id}">$${Math.floor(u.boostCost).toLocaleString()}</span>`;
            boostBtn.onclick = () => {
                console.log('Boost button clicked for upgrade ID:', u.id);
                buyBoost(upgrades.findIndex(up => up.id === u.id));
            };
        } else {
            // Upgrade not unlocked
            boostBtn.disabled = true;
            boostBtn.style.background = '#444';
            boostBtn.style.color = '#888';
            boostBtn.style.cursor = 'not-allowed';
            boostBtn.innerHTML = `PURCHASE ${u.name.replace(/\s+/g,' ').toUpperCase()} FIRST`;
            boostBtn.onclick = null;
        }
    }

    // Format the current yield amount (after all boosts applied)
    const currentYield = u.baseYield * u.level * Math.pow(1.10, u.boostLevel);
    const boostAmtEl = document.getElementById(`boost-amt-${u.id}`);
    if(boostAmtEl) {
        if (currentYield >= 1) {
            boostAmtEl.innerText = currentYield.toFixed(2);
        } else if (currentYield >= 0.0001) {
            boostAmtEl.innerText = (currentYield * 1000000).toFixed(0) + 'Œº';
        } else if (currentYield > 0) {
            boostAmtEl.innerText = (currentYield * 1000000000).toFixed(0);
        } else {
            boostAmtEl.innerText = '0';
        }
    }
});
    }

    setInterval(() => { 
        const now = Date.now();
        const deltaTime = (now - lastTickTime) / 1000; 
        lastTickTime = now;
        if (btcPerSec > 0) { 
            let gain = btcPerSec * deltaTime;
            btcBalance += gain; 
            btcLifetime += gain; 
            updateUI(); 
        } 
    }, 100);

    // Initialize game with manual BTC price
    loadGame(); // Load save data first (including cooldown state)
    initShop(); // Initialize shop after loading
    updateAutoClickerButtonState(); // Apply cooldown state immediately after button creation

    const ctx = document.getElementById('nwChart').getContext('2d');
    const initialChartData = window.savedChartData || Array(60).fill(0);
    const nwChart = new Chart(ctx, {
        type: 'line',
        data: { labels: Array(60).fill(''), datasets: [{ data: initialChartData, borderColor: '#00ff88', borderWidth: 4, pointRadius: 0, fill: true, backgroundColor: 'rgba(0, 255, 136, 0.1)', tension: 0.3 }] },
        options: { responsive: true, maintainAspectRatio: false, scales: { x: { display: false }, y: { display: true } }, plugins: { legend: { display: false } } }
    });

    setInterval(() => {
        nwChart.data.datasets[0].data.push(btcBalance * btcPrice);
        nwChart.data.datasets[0].data.shift();
        nwChart.update('none');
    }, 2000);

    // Auto-save every 1.5 seconds
    setInterval(saveGame, 1500);

    // Update auto-clicker cooldown countdown every second
    setInterval(() => {
        if (autoClickerCooldownEnd > Date.now()) {
            updateAutoClickerButtonState();
        }
    }, 1000);

    // Show offline earnings if applicable
    console.log('Checking for offline earnings:', window.offlineEarningsToShow);
    if (window.offlineEarningsToShow) {
        if (window.offlineEarningsToShow.amount > 0) {
            console.log('Showing offline earnings modal with:', window.offlineEarningsToShow);
            setTimeout(() => {
                showOfflineEarningsModal(window.offlineEarningsToShow.amount, window.offlineEarningsToShow.seconds);
                window.offlineEarningsToShow = null;
            }, 300);
        } else {
            console.log('Offline earnings was 0 or less:', window.offlineEarningsToShow.amount);
        }
    } else {
        console.log('No offline earnings data stored');
    }

    // Start price swings: frequent small swings every 2 seconds + occasional big swings
    frequentPriceSwing(); // Start frequent swings (¬±0.5%-2% every 2 seconds)
    bigPriceSwing();      // Start occasional big swings (¬±5-20% every 5-10 minutes)
</script>

</body>

</html>




