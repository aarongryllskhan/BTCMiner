let packetGameState={isRunning:!1,modalElement:null,canvas:null,ctx:null,cryptoSymbols:[],symbolsCaught:0,gameTime:0,maxGameTime:30,score:0,speed:1,baseSpeed:200,difficulty:"EASY",gameStartTime:0,spawnRate:2,caughtParticles:[],gameActive:!0,manuallyClosed:!1};const CRYPTO_TYPES=[{name:"BTC",symbol:"‚Çø",color:"#f7931a",imagePath:"bitcointoken.png",sizeMultiplier:1},{name:"ETH",symbol:"Œû",color:"#627eea",imagePath:"ethcoin.png",sizeMultiplier:1.12},{name:"DOGE",symbol:"√ê",color:"#c2a633",imagePath:"dogecoin.png",sizeMultiplier:1}],cryptoImages={};function abbreviateNumber(e){return e>=1e60?(e/1e60).toFixed(2)+"Nmdc":e>=1e57?(e/1e57).toFixed(2)+"O/Odc":e>=1e54?(e/1e54).toFixed(2)+"Spdc":e>=1e51?(e/1e51).toFixed(2)+"Sxdc":e>=1e48?(e/1e48).toFixed(2)+"Qdc":e>=1e45?(e/1e45).toFixed(2)+"Qdc":e>=1e42?(e/1e42).toFixed(2)+"Tdc":e>=1e39?(e/1e39).toFixed(2)+"U/Udc":e>=1e36?(e/1e36).toFixed(2)+"D/Ddc":e>=1e33?(e/1e33).toFixed(2)+"Dc":e>=1e30?(e/1e30).toFixed(2)+"N":e>=1e27?(e/1e27).toFixed(2)+"O":e>=1e24?(e/1e24).toFixed(2)+"Sep":e>=1e21?(e/1e21).toFixed(2)+"S":e>=1e18?(e/1e18).toFixed(2)+"Qa":e>=1e15?(e/1e15).toFixed(2)+"Q":e>=1e12?(e/1e12).toFixed(2)+"T":e>=1e9?(e/1e9).toFixed(2)+"B":e>=1e6?(e/1e6).toFixed(2)+"M":e>=1e3?(e/1e3).toFixed(2)+"K":e.toFixed(0)}function initPacketInterceptorGame(e="EASY"){packetGameState.difficulty=e,packetGameState.isRunning=!0,packetGameState.gameActive=!0,packetGameState.cryptoSymbols=[],packetGameState.symbolsCaught=0,packetGameState.score=0,packetGameState.gameTime=0,packetGameState.gameStartTime=Date.now(),packetGameState.caughtParticles=[];let t=15,a=180,n=2,o=.3;"MEDIUM"===e?(t=15,a=280,n=3.5,o=.5):"HARD"===e&&(t=15,a=380,n=5,o=.7),window.innerWidth<768?(a*=1,n*=1):a*=1,packetGameState.speedEscalation=o,packetGameState.maxGameTime=t,packetGameState.baseSpeed=a,packetGameState.spawnRate=n,createPacketInterceptorModal()}function createPacketInterceptorModal(){const e=document.createElement("div");e.id="packet-interceptor-modal",e.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.95);\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n        font-family: Arial, sans-serif;\n        overflow: hidden;\n    ";const t=document.createElement("div");t.style.cssText="\n        position: absolute;\n        top: 20px;\n        right: 20px;\n        z-index: 10001;\n    ";const a=document.createElement("button");a.textContent="√ó",a.style.cssText="\n        background: #ff8c00;\n        color: #000;\n        border: none;\n        padding: 8px 12px;\n        font-weight: 800;\n        border-radius: 4px;\n        cursor: pointer;\n        font-size: 1.2rem;\n        line-height: 1;\n        width: 32px;\n        height: 32px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n    ",a.onclick=function(e){e.stopPropagation(),closePacketInterceptorMidGame()},t.appendChild(a),e.appendChild(t);const n=document.createElement("canvas");n.width=.9*window.innerWidth,n.height=.75*window.innerHeight,n.style.cssText="\n        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);\n        border: 3px solid #ff8c00;\n        border-radius: 12px;\n        cursor: crosshair;\n        display: block;\n        margin-bottom: 20px;\n    ",packetGameState.canvas=n,packetGameState.ctx=n.getContext("2d"),packetGameState.modalElement=e,e.appendChild(n),document.body.appendChild(e),n.addEventListener("click",handleCryptoClick),n.addEventListener("touchstart",handleCryptoTouch),gameLoopPacketInterceptor()}function handleCryptoClick(e){if(!packetGameState.isRunning||!packetGameState.canvasRect)return;const t=packetGameState.canvasRect;checkCryptoCollisions(e.clientX-t.left,e.clientY-t.top)}function handleCryptoTouch(e){if(!packetGameState.isRunning||!packetGameState.canvasRect)return;e.preventDefault();const t=packetGameState.canvasRect;for(let a of e.touches){checkCryptoCollisions(a.clientX-t.left,a.clientY-t.top)}}function checkCryptoCollisions(e,t){for(let a=packetGameState.cryptoSymbols.length-1;a>=0;a--){const n=packetGameState.cryptoSymbols[a],o=n.x-e,i=n.y-t;if(Math.sqrt(o*o+i*i)<60+n.size){packetGameState.symbolsCaught++,packetGameState.score+=n.value,addCaughtParticle(n.x,n.y,n.value,n.color),packetGameState.cryptoSymbols.splice(a,1);break}}}function addCaughtParticle(e,t,a,n){packetGameState.caughtParticles.push({x:e,y:t,value:a,color:n,age:0,maxAge:.8})}function spawnCryptoSymbol(){const e=packetGameState.canvas;if(!e)return;const t=CRYPTO_TYPES[Math.floor(Math.random()*CRYPTO_TYPES.length)];let a=0;const n=window.btcPerSec??btcPerSec??0,o=window.ethPerSec??ethPerSec??0,i=window.dogePerSec??dogePerSec??0,c=window.btcPrice??btcPrice??1e5,l=window.ethPrice??ethPrice??3500,r=window.dogePrice??dogePrice??.25,s=window.totalMiningMultiplier??totalMiningMultiplier??1;if(n>0||o>0||i>0)"BTC"===t.name?a=n*s*c:"ETH"===t.name?a=o*s*l:"DOGE"===t.name&&(a=i*s*r);else{const e={BTC:30,ETH:20,DOGE:10};"BTC"===t.name?a=e.BTC:"ETH"===t.name?a=e.ETH:"DOGE"===t.name&&(a=e.DOGE)}const d=Math.random()*(e.height-80)+40;packetGameState.cryptoSymbols.push({x:-30,y:d,vy:100*(Math.random()-.5)*packetGameState.speed,type:t.name,symbol:t.symbol,color:t.color,value:a,size:50,rotation:0,rotationSpeed:6*(Math.random()-.5),sizeMultiplier:t.sizeMultiplier||1})}function gameLoopPacketInterceptor(){if(!packetGameState.gameActive)return void endPacketInterceptorGame(!1);const e=Date.now(),t=(e-packetGameState.gameStartTime)/1e3;if(packetGameState.gameTime=t,(!packetGameState.canvasRect||e%100<16.67)&&packetGameState.canvas&&(packetGameState.canvasRect=packetGameState.canvas.getBoundingClientRect()),packetGameState.gameTime>=packetGameState.maxGameTime)return packetGameState.isRunning=!1,packetGameState.gameActive=!1,drawPacketInterceptorGame(),void setTimeout(()=>endPacketInterceptorGame(!1),100);const a=packetGameState.gameTime/packetGameState.maxGameTime;packetGameState.speed=1+a*packetGameState.speedEscalation,Math.random()<packetGameState.spawnRate/60&&spawnCryptoSymbol();for(let e=packetGameState.cryptoSymbols.length-1;e>=0;e--){const t=packetGameState.cryptoSymbols[e];t.x+=packetGameState.baseSpeed*packetGameState.speed/60,t.y+=t.vy/60,t.rotation+=t.rotationSpeed/60,t.x>packetGameState.canvas.width+50&&packetGameState.cryptoSymbols.splice(e,1)}for(let e=packetGameState.caughtParticles.length-1;e>=0;e--){const t=packetGameState.caughtParticles[e];t.age+=1/60,t.age>=t.maxAge&&packetGameState.caughtParticles.splice(e,1)}drawPacketInterceptorGame(),requestAnimationFrame(gameLoopPacketInterceptor)}function drawBlockchainBackground(e,t){e.fillStyle="#0a0a1a",e.fillRect(0,0,t.width,t.height),e.strokeStyle="rgba(100, 150, 255, 0.08)",e.lineWidth=1;for(let a=0;a<t.width;a+=100)e.beginPath(),e.moveTo(a,0),e.lineTo(a,t.height),e.stroke();for(let a=0;a<t.height;a+=100)e.beginPath(),e.moveTo(0,a),e.lineTo(t.width,a),e.stroke();e.fillStyle="rgba(100, 200, 255, 0.1)",e.beginPath(),e.arc(t.width/3,t.height/3,3,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(.7*t.width,.7*t.height,2,0,2*Math.PI),e.fill()}function drawHexagon(e,t,a,n){e.beginPath();for(let o=0;o<6;o++){const i=(60*o-30)*Math.PI/180,c=t+n*Math.cos(i),l=a+n*Math.sin(i);0===o?e.moveTo(c,l):e.lineTo(c,l)}e.closePath(),e.stroke()}function drawPacketInterceptorGame(){const e=packetGameState.ctx,t=packetGameState.canvas;if(e&&t){drawBlockchainBackground(e,t);for(let t of packetGameState.cryptoSymbols){e.save(),e.translate(t.x,t.y),e.rotate(t.rotation);const a=e.createRadialGradient(0,0,0,0,0,t.size);a.addColorStop(0,t.color+"40"),a.addColorStop(1,t.color+"00"),e.fillStyle=a,e.fillRect(-t.size,-t.size,2*t.size,2*t.size),e.strokeStyle=t.color,e.lineWidth=4,e.beginPath(),e.arc(0,0,.9*t.size,0,2*Math.PI),e.stroke();const n=cryptoImages[t.type];if(n&&n.complete){let a=1.7*t.size;a*=t.sizeMultiplier;const o=n.width/n.height;let i=a,c=a;o>1?c=a/o:o<1&&(i=a*o),e.drawImage(n,-i/2,-c/2,i,c)}else e.fillStyle=t.color+"cc",e.beginPath(),e.arc(0,0,.85*t.size,0,2*Math.PI),e.fill(),e.fillStyle="#fff",e.font=`bold ${Math.floor(.8*t.size)}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.symbol,0,0);e.restore()}for(let t of packetGameState.caughtParticles){const a=1-t.age/t.maxAge,n=t.y-60*t.age;e.fillStyle=`rgba(255, 255, 0, ${a})`,e.font="bold 24px Arial",e.textAlign="center",e.textBaseline="middle",e.shadowColor=t.color,e.shadowBlur=10,e.fillText("+$"+abbreviateNumber(t.value),t.x,n)}drawPacketInterceptorHUD()}}function drawPacketInterceptorHUD(){const e=packetGameState.ctx,t=packetGameState.canvas;e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(0,0,t.width,50);const a=Math.max(0,packetGameState.maxGameTime-packetGameState.gameTime);e.fillStyle="#ff8c00",e.font="bold 24px Arial",e.textAlign="left",e.textBaseline="top",e.fillText(`‚è± ${a.toFixed(1)}s`,20,12),e.fillStyle="#00ff00",e.textAlign="center",e.fillText(`Caught: ${packetGameState.symbolsCaught}`,t.width/2,12),e.fillStyle="#ffff00",e.textAlign="right",e.fillText(`$${abbreviateNumber(packetGameState.score)}`,t.width-20,12)}function endPacketInterceptorGame(e=!1){if(packetGameState.manuallyClosed&&(packetGameState.manuallyClosed=!1,e=!0),console.log("[Coin Snag] endPacketInterceptorGame called, quit:",e),packetGameState.modalElement&&document.body.contains(packetGameState.modalElement)&&(packetGameState.modalElement.removeEventListener("click",handleCryptoClick),packetGameState.modalElement.removeEventListener("touchstart",handleCryptoTouch),document.body.removeChild(packetGameState.modalElement),packetGameState.modalElement=null),packetGameState.canvas=null,packetGameState.ctx=null,e)return console.log("[Coin Snag] User quit, not showing rewards"),void switchTab("minigames");const t=packetGameState.score,a=t;console.log("[Coin Snag] Calculated reward - Base:",t,"Packets caught:",packetGameState.symbolsCaught,"Total USD:",a),"function"==typeof updatePacketInterceptorStats&&(console.log("[Coin Snag] Calling updatePacketInterceptorStats"),updatePacketInterceptorStats(packetGameState.symbolsCaught,a)),console.log("[Coin Snag] About to show results modal"),showPacketInterceptorResults(a)}function showPacketInterceptorResults(e){console.log("[Coin Snag] Showing results modal, totalReward:",e);const t=document.createElement("div");t.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.95);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 99999;\n        font-family: Arial, sans-serif;\n    ";const a=document.createElement("div");a.style.cssText="\n        background: rgba(0, 0, 0, 0.9);\n        border: 3px solid #ff8c00;\n        border-radius: 16px;\n        padding: 40px;\n        text-align: center;\n        max-width: 500px;\n        color: #fff;\n    ";packetGameState.score;let n=`üí∞ +$${e.toFixed(2)}`;"undefined"!=typeof packetLastRewards&&packetLastRewards&&packetLastRewards.totalUsd>0&&(n=`\n            <div style="font-size: 0.9rem; margin-top: 10px;">\n                <div>‚Çø ${packetLastRewards.btc>=1?packetLastRewards.btc.toFixed(4):packetLastRewards.btc.toFixed(8)} BTC</div>\n                <div>Œû ${packetLastRewards.eth>=1?packetLastRewards.eth.toFixed(4):packetLastRewards.eth.toFixed(8)} ETH</div>\n                <div>√ê ${packetLastRewards.doge.toFixed(2)} DOGE</div>\n                <div style="margin-top: 8px;">üíµ $${abbreviateNumber(packetLastRewards.usd)} USD</div>\n                <div style="color: #ffff00; font-weight: 800; margin-top: 8px;">Total: $${abbreviateNumber(packetLastRewards.totalUsd)}</div>\n            </div>\n        `),a.innerHTML=`\n        <h2 style="color: #ff8c00; margin: 0 0 20px 0; font-size: 2.5rem;">üéâ Game Complete!</h2>\n\n        <div style="background: rgba(0,0,0,0.5); border-radius: 12px; padding: 30px; margin-bottom: 30px;">\n            <div style="display: flex; justify-content: space-around; margin-bottom: 20px;">\n                <div>\n                    <div style="color: #888; font-size: 0.9rem;">Difficulty</div>\n                    <div style="color: #ff8c00; font-size: 1.2rem; font-weight: 800;">${{EASY:"Easy",MEDIUM:"Medium",HARD:"Hard"}[packetGameState.difficulty]}</div>\n                </div>\n                <div>\n                    <div style="color: #888; font-size: 0.9rem;">Coins</div>\n                    <div style="color: #00ff00; font-size: 1.2rem; font-weight: 800;">${packetGameState.symbolsCaught}</div>\n                </div>\n            </div>\n\n            <div style="border-top: 2px solid #ff8c00; border-bottom: 2px solid #ff8c00; padding: 20px 0; margin: 20px 0;">\n                <div style="color: #888; font-size: 0.95rem; margin-bottom: 8px; font-weight: 700;">FORMULA BREAKDOWN</div>\n                <div style="color: #fff; font-size: 0.85rem; margin-bottom: 15px; text-align: center; line-height: 1.6;">\n                    <div>Coins Caught: ${packetGameState.symbolsCaught}</div>\n                    <div style="margin: 6px 0;">√ó</div>\n                    <div style="font-size: 0.8rem; color: #ffb81c;">Per Coin Base Value:</div>\n                    <div style="font-size: 0.75rem; color: #aaa; margin: 4px 0;">‚Çø BTC = $30 | Œû ETH = $20 | √ê DOGE = $10</div>\n                    <div style="font-size: 0.8rem; color: #ffb81c; margin-top: 4px;">(Plus your Mining Rate USD Value if available)</div>\n                    <div style="margin: 6px 0;">= Total Reward</div>\n                </div>\n\n                <div style="color: #888; font-size: 0.95rem; margin-bottom: 15px; font-weight: 700; margin-top: 15px;">YOUR REWARDS</div>\n                <div style="font-size: 0.75rem; color: #aaa; margin-bottom: 12px; font-style: italic;">\n                    Paid as: 40% BTC ‚Ä¢ 35% ETH ‚Ä¢ 20% DOGE ‚Ä¢ 5% Cash\n                </div>\n                ${n}\n            </div>\n        </div>\n\n        <button id="packet-close-btn" style="background: #ff8c00; color: #000; border: none; padding: 15px 30px; font-weight: 800; border-radius: 8px; cursor: pointer; font-size: 1rem;">\n            CLAIM REWARDS\n        </button>\n    `,t.appendChild(a),t.id="packet-results-modal",document.body.appendChild(t),console.log("[Coin Snag] Results modal appended to document body");const o=document.getElementById("packet-close-btn");o?o.onclick=()=>{console.log("[Coin Snag] Claiming rewards and closing modal"),"function"==typeof spawnPacketInterceptorRewardCoins&&spawnPacketInterceptorRewardCoins(),document.getElementById("packet-results-modal").remove(),switchTab("minigames")}:console.error("[Coin Snag] Close button not found!")}function closePacketInterceptorMidGame(){if(packetGameState.gameActive&&packetGameState.isRunning){packetGameState.gameActive=!1,packetGameState.isRunning=!1,packetGameState.manuallyClosed=!0;const e=packetGameState.difficulty,t=3e4;"undefined"!=typeof packetCooldowns&&(packetCooldowns[e]=Date.now()+t,console.log(`[Packet Interceptor] Applied cooldown to ${e}: ${t}ms`),"function"==typeof updatePacketCooldownDisplays&&updatePacketCooldownDisplays())}packetGameState.modalElement&&document.body.contains(packetGameState.modalElement)&&(packetGameState.modalElement.removeEventListener("click",handleCryptoClick),packetGameState.modalElement.removeEventListener("touchstart",handleCryptoTouch),document.body.removeChild(packetGameState.modalElement),packetGameState.modalElement=null),"function"==typeof switchTab&&switchTab("minigames")}CRYPTO_TYPES.forEach(e=>{const t=new Image;t.src=e.imagePath,cryptoImages[e.name]=t});